<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Statement Analysis v4.0.1 - Meta vs Alphabet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0f4c75;
            --secondary: #3282b8;
            --accent: #f39c12;
            --success: #27ae60;
            --danger: #e74c3c;
            --bg-dark: #0a1929;
            --bg-card: #132f4c;
            --text-light: #e3f2fd;
            --text-muted: #90caf9;
            --border: #1e4976;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%);
            color: var(--text-light);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            margin-bottom: 10px;
            color: #fff;
        }

        .subtitle {
            color: #b8d4e8;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
        }

        .version-badge {
            display: inline-block;
            background: var(--accent);
            color: var(--bg-dark);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select {
            width: 100%;
            padding: 12px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid var(--border);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .card-title {
            font-size: clamp(1.3rem, 4vw, 1.8rem);
            margin-bottom: 8px;
            color: var(--accent);
        }

        .card-subtitle {
            color: var(--text-muted);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -20px;
            padding: 0 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th {
            background: var(--primary);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--accent);
            font-size: 0.85rem;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        tr:hover {
            background: rgba(50, 130, 184, 0.1);
        }

        .number {
            text-align: right;
            font-family: 'Courier New', monospace;
            font-weight: 500;
        }

        .positive {
            color: var(--success);
            font-weight: bold;
        }

        .negative {
            color: var(--danger);
            font-weight: bold;
        }

        .ratio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .ratio-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--bg-card) 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border);
            transition: transform 0.3s;
            position: relative;
        }

        .ratio-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
        }

        .ratio-name {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 500;
            cursor: help;
            position: relative;
        }

        .ratio-name:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            color: var(--text-light);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            text-transform: none;
            white-space: normal;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            margin-bottom: 5px;
        }

        .ratio-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            cursor: help;
            position: relative;
        }

        .ratio-value:hover::after {
            content: attr(data-calc);
            position: absolute;
            bottom: 100%;
            left: 0;
            background: rgba(0, 0, 0, 0.95);
            color: var(--text-light);
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 0.75rem;
            white-space: pre-line;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            margin-bottom: 5px;
            min-width: 250px;
            max-width: 350px;
            border-left: 3px solid var(--accent);
        }

        .ratio-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .category-header {
            background: var(--primary);
            padding: 12px 15px;
            border-radius: 10px;
            margin: 25px 0 15px 0;
            font-size: 1.2rem;
            font-weight: bold;
            border-left: 4px solid var(--accent);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .comparison-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .company-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .metric-label {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .metric-value {
            font-weight: bold;
            color: var(--text-light);
            font-family: 'Courier New', monospace;
        }

        .na-badge {
            color: var(--text-muted);
            font-style: italic;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px 15px;
            }

            .card {
                padding: 15px;
            }

            .ratio-grid {
                grid-template-columns: 1fr;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 8px;
            }

            .ratio-name:hover::after,
            .ratio-value:hover::after {
                position: fixed;
                left: 10px;
                right: 10px;
                bottom: auto;
                top: 50%;
                transform: translateY(-50%);
                max-width: calc(100vw - 20px);
            }
        }

        .hidden {
            display: none;
        }

        .ratio-guide-btn {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--accent) 0%, #e67e22 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        .ratio-guide-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }

        .ratio-guide-btn:active {
            transform: translateY(0);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            overflow: auto;
        }

        .modal-content {
            background: var(--bg-card);
            margin: 30px auto;
            padding: 0;
            border: 2px solid var(--border);
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px 30px;
            border-radius: 13px 13px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: white;
            font-size: 1.8rem;
        }

        .close-btn {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .ratio-section {
            margin-bottom: 40px;
        }

        .ratio-section-title {
            background: var(--primary);
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
        }

        .ratio-item {
            background: rgba(50, 130, 184, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 3px solid var(--accent);
        }

        .ratio-item-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .ratio-item-definition {
            color: var(--text-light);
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .ratio-item-formula {
            background: var(--bg-dark);
            padding: 10px 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin-bottom: 15px;
            border-left: 3px solid var(--secondary);
        }

        .ratio-item-example {
            background: var(--bg-dark);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .ratio-item-example h4 {
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .ratio-item-interpretation {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-style: italic;
        }

        /* SPLIT SCREEN LAYOUT */
        .split-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            margin-top: 20px;
        }
        
        .data-panel {
            flex: 1;
            min-width: 0;
        }
        
        .game-panel {
            width: 420px;
            flex-shrink: 0;
            position: sticky;
            top: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 2px solid var(--primary);
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            transition: all 0.3s ease;
        }
        
        .game-panel.minimized {
            width: 60px;
            overflow: hidden;
        }
        
        .game-panel.minimized .game-content-inner {
            display: none;
        }
        
        .game-panel-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        
        .game-panel-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .minimize-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1.2rem;
        }
        
        .minimize-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .game-content-inner {
            padding: 20px;
        }
        
        .start-game-prompt {
            text-align: center;
            padding: 40px 20px;
        }
        
        .start-game-prompt h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .start-game-prompt p {
            color: var(--text-muted);
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        /* Mobile responsive */
        @media (max-width: 1024px) {
            .split-container {
                flex-direction: column;
            }
            
            .game-panel {
                width: 100%;
                position: relative;
                top: 0;
                order: -1;
            }
            
            .game-panel.minimized {
                width: 100%;
                height: 60px;
            }
        }

        /* QUICK RATIO LOOKUP */
        .quick-ratio-lookup {
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            overflow: hidden;
        }

        .quick-ratio-body {
            padding: 20px;
        }

        .quick-ratio-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .quick-ratio-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-ratio-header .ratio-guide-btn {
            width: auto;
            padding: 8px 16px;
            font-size: 0.9rem;
            margin: 0;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .quick-ratio-header .ratio-guide-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .quick-ratio-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .quick-ratio-controls select {
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: white;
            color: #2c3e50;
            font-size: 0.95rem;
            cursor: pointer;
            font-weight: 500;
        }

        .quick-ratio-display {
            background: white;
            border-radius: 8px;
            padding: 15px;
            min-height: 80px;
        }

        .ratio-comparison-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 5px 0;
            background: #2c3e50;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .ratio-comparison-row:hover {
            background: #34495e;
        }

        .ratio-comparison-row.highlight {
            background: #2c3e50;
            border-left: 4px solid #f39c12;
            font-weight: 600;
        }

        .ratio-company-name {
            font-weight: 500;
            color: white;
            font-size: 0.95rem;
        }

        .ratio-value {
            font-weight: 600;
            color: #d4a574;
            font-size: 1.05rem;
        }

        .ratio-comparison-row.highlight .ratio-value {
            color: #f39c12;
        }

        .ratio-category-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .ratio-category-table th {
            background: #2c3e50;
            color: white;
            padding: 10px;
            text-align: left;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .ratio-category-table td {
            padding: 10px;
            background: #2c3e50;
            color: #d4a574;
            border-bottom: 1px solid #34495e;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .ratio-category-table td:first-child {
            color: white;
            font-weight: 600;
        }

        .ratio-category-table tr:hover td {
            background: #34495e;
        }

        .ratio-category-table .best-value {
            color: #f39c12;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .quick-ratio-controls {
                grid-template-columns: 1fr;
            }
        }

        /* GAME DASHBOARD IN PANEL */
        .first-time-hint {
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 100%);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .first-time-hint-content {
            color: white;
            font-weight: 600;
        }

        .first-time-hint-buttons {
            display: flex;
            gap: 10px;
        }

        .first-time-hint button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .hint-dismiss {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .hint-try {
            background: white;
            color: #3498db;
        }

        .hint-dismiss:hover,
        .hint-try:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* GAME INTERFACE */
        .game-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .game-dashboard {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--border);
        }

        .game-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-subtitle {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        .level-card {
            background: rgba(50, 130, 184, 0.1);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
            position: relative;
        }

        .level-card.locked {
            opacity: 0.6;
            border-left-color: var(--text-muted);
        }

        .level-card.completed {
            border-left-color: #2ecc71;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .level-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .level-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .level-status.unlocked {
            background: #3498db;
            color: white;
        }

        .level-status.completed {
            background: #2ecc71;
            color: white;
        }

        .level-status.locked {
            background: var(--bg-dark);
            color: var(--text-muted);
        }

        .level-info {
            color: var(--text-light);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .level-progress {
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: var(--bg-dark);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .level-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .level-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .level-button.primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        .level-button.secondary {
            background: var(--bg-dark);
            color: var(--text-light);
            border: 2px solid var(--border);
        }

        .level-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .level-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* QUESTION INTERFACE */
        .question-container {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--border);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .question-number {
            font-size: 1rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        .question-score {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--accent);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }

        .answer-option {
            background: rgba(50, 130, 184, 0.1);
            padding: 15px 20px;
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .answer-option:hover {
            background: rgba(50, 130, 184, 0.2);
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .answer-option.selected {
            background: rgba(52, 152, 219, 0.3);
            border-color: var(--accent);
            font-weight: 600;
        }

        .question-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .action-button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-button.submit {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .action-button.hint {
            background: var(--accent);
            color: white;
        }

        .action-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }

        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* FEEDBACK */
        .feedback-container {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--border);
            margin-top: 20px;
        }

        .feedback-container.correct {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }

        .feedback-container.incorrect {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .feedback-header {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-header.correct {
            color: #2ecc71;
        }

        .feedback-header.incorrect {
            color: #e74c3c;
        }

        .feedback-section {
            margin: 20px 0;
            padding: 15px;
            background: var(--bg-dark);
            border-radius: 8px;
        }

        .feedback-section h4 {
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .feedback-data {
            font-family: 'Courier New', monospace;
            line-height: 1.8;
        }

        .feedback-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .side-by-side {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .side-by-side {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Financial Statement Analysis<span class="version-badge">v6.0</span></h1>
            <p class="subtitle">Alphabet, Meta & Apple | 2022-2024</p>
        </div>

        <!-- Split Screen Layout -->
        <div class="split-container">
            <!-- LEFT: Data Panel -->
            <div class="data-panel">
        
        <!-- Quick Ratio Lookup -->
        <div class="quick-ratio-lookup">
            <div class="quick-ratio-header">
                <div class="quick-ratio-title">
                    <span>‚ö°</span>
                    <span>Quick Ratio Lookup</span>
                </div>
                <button id="ratioGuideBtn" class="ratio-guide-btn">üìö Ratio Review Guide</button>
            </div>
            <div class="quick-ratio-body">
                <div class="quick-ratio-controls">
                    <select id="quickRatioSelect">
                        <option value="">-- Select Individual Ratio --</option>
                        <optgroup label="Liquidity">
                            <option value="workingCapital">Working Capital</option>
                            <option value="currentRatio">Current Ratio</option>
                            <option value="cashRatio">Cash Ratio</option>
                            <option value="acidTest">Acid-Test Ratio</option>
                        </optgroup>
                        <optgroup label="Activity">
                            <option value="inventoryTurnover">Inventory Turnover</option>
                            <option value="daysInventory">Days' Sales in Inventory</option>
                            <option value="grossProfitPct">Gross Profit Percentage</option>
                            <option value="arTurnover">A/R Turnover</option>
                            <option value="daysReceivables">Days' Sales in Receivables</option>
                        </optgroup>
                        <optgroup label="Solvency">
                            <option value="debtToAsset">Debt to Asset Ratio</option>
                            <option value="debtToEquity">Debt to Equity Ratio</option>
                            <option value="timesInterest">Times Interest Earned</option>
                        </optgroup>
                        <optgroup label="Profitability">
                            <option value="profitMargin">Profit Margin on Sales</option>
                            <option value="roa">Return on Assets (ROA)</option>
                            <option value="assetTurnover">Asset Turnover</option>
                            <option value="roe">Return on Equity (ROE)</option>
                            <option value="eps">Earnings Per Share (EPS)</option>
                        </optgroup>
                        <optgroup label="Investment">
                            <option value="peRatio">P/E Ratio</option>
                            <option value="dividendYield">Dividend Yield</option>
                            <option value="dividendPayout">Dividend Payout</option>
                        </optgroup>
                    </select>
                    <select id="quickCategorySelect">
                        <option value="">-- Or Select Category --</option>
                        <option value="liquidity">All Liquidity Ratios</option>
                        <option value="activity">All Activity Ratios</option>
                        <option value="solvency">All Solvency Ratios</option>
                        <option value="profitability">All Profitability Ratios</option>
                        <option value="investment">All Investment Ratios</option>
                    </select>
                </div>
                <div class="quick-ratio-display" id="quickRatioDisplay">
                    <div style="color: var(--text-muted); text-align: center; padding: 20px;">
                        Select a ratio or category above to compare all three companies
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Select Company</label>
                <select id="companySelect">
                    <option value="alphabet">Alphabet (Google)</option>
                    <option value="meta">Meta Platforms</option>
                    <option value="apple">Apple Inc.</option>
                    <option value="compare">Compare Companies...</option>
                </select>
            </div>
            <div class="control-group" id="comparisonGroup" style="display: none;">
                <label>Select Comparison</label>
                <select id="comparisonSelect">
                    <option value="">-- Choose Companies --</option>
                    <option value="alphabet-meta">Alphabet vs Meta</option>
                    <option value="alphabet-apple">Alphabet vs Apple</option>
                    <option value="meta-apple">Meta vs Apple</option>
                    <option value="all-three">All Three Companies</option>
                </select>
            </div>
            <div class="control-group">
                <label>Select Analysis Type</label>
                <select id="analysisSelect">
                    <option value="horizontal">Horizontal Analysis</option>
                    <option value="vertical">Vertical Analysis</option>
                    <option value="trend">Trend Analysis</option>
                    <option value="ratios">Financial Ratios</option>
                </select>
            </div>
            <div class="control-group" id="yearGroup">
                <label>Select Period</label>
                <select id="yearSelect">
                    <option value="2022-2023">2022-2023</option>
                    <option value="2023-2024">2023-2024</option>
                </select>
            </div>
            <div class="control-group" id="ratioYearGroup" style="display: none;">
                <label>Select Year</label>
                <select id="ratioYearSelect">
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                </select>
            </div>
        </div>

        <div id="content"></div>
        </div>
        <!-- End Data Panel -->

        <!-- RIGHT: Game Panel -->
        <div class="game-panel" id="gamePanel">
            <div class="game-panel-header" onclick="toggleGamePanel()">
                <div class="game-panel-title">
                    <span>üîç</span>
                    <span>Financial Detective</span>
                </div>
                <button class="minimize-btn" id="minimizeBtn">‚àí</button>
            </div>
            <div class="game-content-inner" id="gameContent">
                <!-- Game content will load here -->
            </div>
        </div>
        <!-- End Game Panel -->

        </div>
        <!-- End Split Container -->

        <!-- Ratio Review Guide Modal -->
        <div id="ratioGuideModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìö Ratio Review Guide</h2>
                    <button class="close-btn" id="closeModal">&times;</button>
                </div>
                <div class="modal-body" id="ratioGuideContent">
                    <!-- Content will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data from Excel file
        const DATA = {
            alphabet: {
                horizontal: {
                    '2022-2023': [
                        { item: 'Revenues', y2023: 307394, y2022: 282836, diff: 24558, pct: 8.683 },
                        { item: 'Cost of revenues', y2023: 133332, y2022: 126203, diff: 7129, pct: 5.649 },
                        { item: 'Research & development', y2023: 45427, y2022: 39500, diff: 5927, pct: 15.005 },
                        { item: 'Sales and marketing', y2023: 27917, y2022: 26567, diff: 1350, pct: 5.081 },
                        { item: 'General and administrative', y2023: 16425, y2022: 15724, diff: 701, pct: 4.458 },
                        { item: 'Total costs and expenses', y2023: 223101, y2022: 207994, diff: 15107, pct: 7.263 },
                        { item: 'Income from operations', y2023: 84293, y2022: 74842, diff: 9451, pct: 12.628 },
                        { item: 'Other income (expense), net', y2023: 1424, y2022: -3514, diff: 4938, pct: -140.524 },
                        { item: 'Income before income taxes', y2023: 85717, y2022: 71328, diff: 14389, pct: 20.173 },
                        { item: 'Provision for income taxes', y2023: 11922, y2022: 11356, diff: 566, pct: 4.984 },
                        { item: 'Net income', y2023: 73795, y2022: 59972, diff: 13823, pct: 23.049 }
                    ],
                    '2023-2024': [
                        { item: 'Revenues', y2024: 350018, y2023: 307394, diff: 42624, pct: 13.866 },
                        { item: 'Cost of revenues', y2024: 146306, y2023: 133332, diff: 12974, pct: 9.731 },
                        { item: 'Research & development', y2024: 49326, y2023: 45427, diff: 3899, pct: 8.583 },
                        { item: 'Sales and marketing', y2024: 27808, y2023: 27917, diff: -109, pct: -0.390 },
                        { item: 'General and administrative', y2024: 14188, y2023: 16425, diff: -2237, pct: -13.620 },
                        { item: 'Total costs and expenses', y2024: 237628, y2023: 223101, diff: 14527, pct: 6.511 },
                        { item: 'Income from operations', y2024: 112390, y2023: 84293, diff: 28097, pct: 33.333 },
                        { item: 'Other income (expense), net', y2024: 7425, y2023: 1424, diff: 6001, pct: 421.419 },
                        { item: 'Income before income taxes', y2024: 119815, y2023: 85717, diff: 34098, pct: 39.780 },
                        { item: 'Provision for income taxes', y2024: 19697, y2023: 11922, diff: 7775, pct: 65.216 },
                        { item: 'Net income', y2024: 100118, y2023: 73795, diff: 26323, pct: 35.663 }
                    ]
                },
                vertical: {
                    '2022-2023': [
                        { item: 'Revenues', y2023: 307394, pct2023: 100.0, y2022: 282836, pct2022: 100.0 },
                        { item: 'Cost of revenues', y2023: 133332, pct2023: 43.375, y2022: 126203, pct2022: 44.621 },
                        { item: 'Research & development', y2023: 45427, pct2023: 14.778, y2022: 39500, pct2022: 13.966 },
                        { item: 'Sales and marketing', y2023: 27917, pct2023: 9.082, y2022: 26567, pct2022: 9.393 },
                        { item: 'General and administrative', y2023: 16425, pct2023: 5.343, y2022: 15724, pct2022: 5.559 },
                        { item: 'Total costs and expenses', y2023: 223101, pct2023: 72.578, y2022: 207994, pct2022: 73.539 },
                        { item: 'Income from operations', y2023: 84293, pct2023: 27.422, y2022: 74842, pct2022: 26.461 },
                        { item: 'Net income', y2023: 73795, pct2023: 24.007, y2022: 59972, pct2022: 21.204 }
                    ],
                    '2023-2024': [
                        { item: 'Revenues', y2024: 350018, pct2024: 100.0, y2023: 307394, pct2023: 100.0 },
                        { item: 'Cost of revenues', y2024: 146306, pct2024: 41.800, y2023: 133332, pct2023: 43.375 },
                        { item: 'Research & development', y2024: 49326, pct2024: 14.092, y2023: 45427, pct2023: 14.778 },
                        { item: 'Sales and marketing', y2024: 27808, pct2024: 7.945, y2023: 27917, pct2023: 9.082 },
                        { item: 'General and administrative', y2024: 14188, pct2024: 4.054, y2023: 16425, pct2023: 5.343 },
                        { item: 'Total costs and expenses', y2024: 237628, pct2024: 67.890, y2023: 223101, pct2023: 72.578 },
                        { item: 'Income from operations', y2024: 112390, pct2024: 32.110, y2023: 84293, pct2023: 27.422 },
                        { item: 'Net income', y2024: 100118, pct2024: 28.604, y2023: 73795, pct2023: 24.006 }
                    ]
                },
                trend: {
                    revenue: { 2022: 282836, 2023: 307394, 2024: 350018 },
                    netIncome: { 2022: 59972, 2023: 73795, 2024: 100118 },
                    operatingCashFlow: { 2022: 91495, 2023: 101746, 2024: 125299 }
                }
            },
            meta: {
                horizontal: {
                    '2022-2023': [
                        { item: 'Revenues', y2023: 134902, y2022: 116609, diff: 18293, pct: 15.688 },
                        { item: 'Cost of revenues', y2023: 25959, y2022: 25249, diff: 710, pct: 2.812 },
                        { item: 'Research & development', y2023: 38483, y2022: 35338, diff: 3145, pct: 8.900 },
                        { item: 'Marketing and Sales', y2023: 12301, y2022: 15262, diff: -2961, pct: -19.401 },
                        { item: 'General and administrative', y2023: 11408, y2022: 11816, diff: -408, pct: -3.453 },
                        { item: 'Total costs and expenses', y2023: 88151, y2022: 87665, diff: 486, pct: 0.554 },
                        { item: 'Income from operations', y2023: 46751, y2022: 28944, diff: 17807, pct: 61.522 },
                        { item: 'Interest and other income (expense) net', y2023: 677, y2022: -125, diff: 802, pct: -641.600 },
                        { item: 'Income before provision for income taxes', y2023: 47428, y2022: 28819, diff: 18609, pct: 64.572 },
                        { item: 'Provision for income taxes', y2023: 8330, y2022: 5619, diff: 2711, pct: 48.247 },
                        { item: 'Net income', y2023: 39098, y2022: 23200, diff: 15898, pct: 68.534 }
                    ],
                    '2023-2024': [
                        { item: 'Revenues', y2024: 164501, y2023: 134902, diff: 29599, pct: 21.941 },
                        { item: 'Cost of revenues', y2024: 30161, y2023: 25959, diff: 4202, pct: 16.187 },
                        { item: 'Research & development', y2024: 43873, y2023: 38483, diff: 5390, pct: 14.006 },
                        { item: 'Marketing and Sales', y2024: 11347, y2023: 12301, diff: -954, pct: -7.756 },
                        { item: 'General and administrative', y2024: 9740, y2023: 11408, diff: -1668, pct: -14.621 },
                        { item: 'Total costs and expenses', y2024: 95121, y2023: 88151, diff: 6970, pct: 7.907 },
                        { item: 'Income from operations', y2024: 69380, y2023: 46751, diff: 22629, pct: 48.403 },
                        { item: 'Interest and other income (expense) net', y2024: 1283, y2023: 677, diff: 606, pct: 89.513 },
                        { item: 'Income before provision for income taxes', y2024: 70663, y2023: 47428, diff: 23235, pct: 48.990 },
                        { item: 'Provision for income taxes', y2024: 8303, y2023: 8330, diff: -27, pct: -0.324 },
                        { item: 'Net income', y2024: 62360, y2023: 39098, diff: 23262, pct: 59.493 }
                    ]
                },
                vertical: {
                    '2022-2023': [
                        { item: 'Revenues', y2023: 134902, pct2023: 100.0, y2022: 116609, pct2022: 100.0 },
                        { item: 'Cost of revenues', y2023: 25959, pct2023: 19.243, y2022: 25249, pct2022: 21.653 },
                        { item: 'Research & development', y2023: 38483, pct2023: 28.527, y2022: 35338, pct2022: 30.305 },
                        { item: 'Marketing and Sales', y2023: 12301, pct2023: 9.119, y2022: 15262, pct2022: 13.088 },
                        { item: 'General and administrative', y2023: 11408, pct2023: 8.457, y2022: 11816, pct2022: 10.133 },
                        { item: 'Total costs and expenses', y2023: 88151, pct2023: 65.345, y2022: 87665, pct2022: 75.179 },
                        { item: 'Income from operations', y2023: 46751, pct2023: 34.656, y2022: 28944, pct2022: 24.821 },
                        { item: 'Net income', y2023: 39098, pct2023: 28.985, y2022: 23200, pct2022: 19.895 }
                    ],
                    '2023-2024': [
                        { item: 'Revenues', y2024: 164501, pct2024: 100.0, y2023: 134902, pct2023: 100.0 },
                        { item: 'Cost of revenues', y2024: 30161, pct2024: 18.335, y2023: 25959, pct2023: 19.243 },
                        { item: 'Research & development', y2024: 43873, pct2024: 26.670, y2023: 38483, pct2023: 28.527 },
                        { item: 'Marketing and Sales', y2024: 11347, pct2024: 6.898, y2023: 12301, pct2023: 9.119 },
                        { item: 'General and administrative', y2024: 9740, pct2024: 5.921, y2023: 11408, pct2023: 8.457 },
                        { item: 'Total costs and expenses', y2024: 95121, pct2024: 57.824, y2023: 88151, pct2023: 65.345 },
                        { item: 'Income from operations', y2024: 69380, pct2024: 42.176, y2023: 46751, pct2023: 34.656 },
                        { item: 'Net income', y2024: 62360, pct2024: 37.909, y2023: 39098, pct2023: 28.985 }
                    ]
                },
                trend: {
                    revenue: { 2022: 116609, 2023: 134902, 2024: 164501 },
                    netIncome: { 2022: 23200, 2023: 39098, 2024: 62360 },
                    operatingCashFlow: { 2022: 50475, 2023: 71113, 2024: 91328 }
                }
            },
            apple: {
                horizontal: {
                    '2022-2023': [
                        { item: 'Products', y2023: 298085.0, y2022: 316199.0, diff: -18114.0, pct: -5.729 },
                        { item: 'Services', y2023: 85200.0, y2022: 78129.0, diff: 7071.0, pct: 9.050 },
                        { item: 'Total Net Sales', y2023: 383285.0, y2022: 394328.0, diff: -11043.0, pct: -2.800 },
                        { item: 'Products', y2023: 189282.0, y2022: 201471.0, diff: -12189.0, pct: -6.050 },
                        { item: 'Services', y2023: 24855.0, y2022: 22075.0, diff: 2780.0, pct: 12.593 },
                        { item: 'Total Cost of Sales', y2023: 214137.0, y2022: 223546.0, diff: -9409.0, pct: -4.209 },
                        { item: 'Gross Margin', y2023: 169148.0, y2022: 170782.0, diff: 0, pct: 0.000 },
                        { item: 'Research & development', y2023: 29915.0, y2022: 26251.0, diff: 3664.0, pct: 13.958 },
                        { item: 'Selling, general and administrative', y2023: 24932.0, y2022: 25094.0, diff: -162.0, pct: -0.646 },
                        { item: 'Total Operating expenses', y2023: 54847.0, y2022: 51345.0, diff: 3502.0, pct: 6.821 },
                        { item: 'Income from operations', y2023: 114301.0, y2022: 119437.0, diff: -5136.0, pct: -4.300 },
                        { item: 'Other income (expense), net', y2023: -565.0, y2022: -334.0, diff: -231.0, pct: 69.162 },
                        { item: 'Income before income taxes', y2023: 113736.0, y2022: 119103.0, diff: -5367.0, pct: -4.506 },
                        { item: 'Provision for income taxes', y2023: 16741.0, y2022: 19300.0, diff: -2559.0, pct: -13.259 },
                        { item: 'Net Income', y2023: 96995.0, y2022: 99803.0, diff: -2808.0, pct: -2.814 },
                        { item: 'Basic EPS', y2023: 6.16, y2022: 6.1, diff: 0, pct: 0.000 },
                        { item: 'Diluted EPS', y2023: 6.13, y2022: 6.11, diff: 0, pct: 0.000 },
                        { item: 'Net cash provided by operating activities', y2023: 110543.0, y2022: 122151.0, diff: -11608.0, pct: -9.503 },
                        { item: 'Net cash provided by investing activities', y2023: 3705.0, y2022: -22354.0, diff: 26059.0, pct: -116.574 },
                        { item: 'Net cash provided by financing activities', y2023: -108488.0, y2022: -110749.0, diff: 2261.0, pct: -2.042 },
                        { item: 'Net change in cash', y2023: 5760.0, y2022: -10952.0, diff: 16712.0, pct: -152.593 }
                    ],
                    '2023-2024': [
                        { item: 'Products', y2024: 294866.0, y2023: 298085.0, diff: -3219.0, pct: -1.080 },
                        { item: 'Services', y2024: 96169.0, y2023: 85200.0, diff: 10969.0, pct: 12.874 },
                        { item: 'Total Net Sales', y2024: 391035.0, y2023: 383285.0, diff: 7750.0, pct: 2.022 },
                        { item: 'Products', y2024: 185233.0, y2023: 189282.0, diff: -4049.0, pct: -2.139 },
                        { item: 'Services', y2024: 25119.0, y2023: 24855.0, diff: 264.0, pct: 1.062 },
                        { item: 'Total Cost of Sales', y2024: 210352.0, y2023: 214137.0, diff: -3785.0, pct: -1.768 },
                        { item: 'Gross Margin', y2024: 180683.0, y2023: 169148.0, diff: 0, pct: 0.000 },
                        { item: 'Research & development', y2024: 31370.0, y2023: 29915.0, diff: 1455.0, pct: 4.864 },
                        { item: 'Selling, general and administrative', y2024: 26097.0, y2023: 24932.0, diff: 1165.0, pct: 4.673 },
                        { item: 'Total Operating expenses', y2024: 57467.0, y2023: 54847.0, diff: 2620.0, pct: 4.777 },
                        { item: 'Income from operations', y2024: 123216.0, y2023: 114301.0, diff: 8915.0, pct: 7.800 },
                        { item: 'Other income (expense), net', y2024: 269.0, y2023: -565.0, diff: 834.0, pct: -147.611 },
                        { item: 'Income before income taxes', y2024: 123485.0, y2023: 113736.0, diff: 9749.0, pct: 8.572 },
                        { item: 'Provision for income taxes', y2024: 29749.0, y2023: 16741.0, diff: 13008.0, pct: 77.701 },
                        { item: 'Net Income', y2024: 93736.0, y2023: 96995.0, diff: -3259.0, pct: -3.360 },
                        { item: 'Basic EPS', y2024: 6.11, y2023: 6.16, diff: 0, pct: 0.000 },
                        { item: 'Diluted EPS', y2024: 6.08, y2023: 6.13, diff: 0, pct: 0.000 },
                        { item: 'Net cash provided by operating activities', y2024: 118254.0, y2023: 110543.0, diff: 7711.0, pct: 6.976 },
                        { item: 'Net cash provided by investing activities', y2024: 2935.0, y2023: 3705.0, diff: -770.0, pct: -20.783 },
                        { item: 'Net cash provided by financing activities', y2024: -121983.0, y2023: -108488.0, diff: -13495.0, pct: 12.439 },
                        { item: 'Net change in cash', y2024: -794.0, y2023: 5760.0, diff: -6554.0, pct: -113.785 }
                    ]
                },
                vertical: {
                    '2022-2023': [
                        { item: 'Products', y2023: 298085.0, pct2023: 100.000, y2022: 316199.0, pct2022: 100.000 },
                        { item: 'Services', y2023: 85200.0, pct2023: 100.000, y2022: 78129.0, pct2022: 100.000 },
                        { item: 'Total Net Sales', y2023: 383285.0, pct2023: 100.000, y2022: 394328.0, pct2022: 100.000 },
                        { item: 'Products', y2023: 189282.0, pct2023: 49.384, y2022: 201471.0, pct2022: 51.092 },
                        { item: 'Services', y2023: 24855.0, pct2023: 6.485, y2022: 22075.0, pct2022: 5.598 },
                        { item: 'Total Cost of Sales', y2023: 214137.0, pct2023: 55.869, y2022: 223546.0, pct2022: 56.690 },
                        { item: 'Gross Margin', y2023: 169148.0, pct2023: 44.131, y2022: 170782.0, pct2022: 43.310 },
                        { item: 'Research & development', y2023: 29915.0, pct2023: 7.805, y2022: 26251.0, pct2022: 6.657 },
                        { item: 'Selling, general and administrative', y2023: 24932.0, pct2023: 6.505, y2022: 25094.0, pct2022: 6.364 },
                        { item: 'Total Operating expenses', y2023: 54847.0, pct2023: 14.310, y2022: 51345.0, pct2022: 13.021 },
                        { item: 'Income from operations', y2023: 114301.0, pct2023: 29.821, y2022: 119437.0, pct2022: 30.289 },
                        { item: 'Other income (expense), net', y2023: -565.0, pct2023: -0.147, y2022: -334.0, pct2022: -0.085 },
                        { item: 'Income before income taxes', y2023: 113736.0, pct2023: 29.674, y2022: 119103.0, pct2022: 30.204 },
                        { item: 'Provision for income taxes', y2023: 16741.0, pct2023: 4.368, y2022: 19300.0, pct2022: 4.894 },
                        { item: 'Net Income', y2023: 96995.0, pct2023: 25.306, y2022: 99803.0, pct2022: 25.310 }
                    ],
                    '2023-2024': [
                        { item: 'Products', y2024: 294866.0, pct2024: 100.000, y2023: 298085.0, pct2023: 100.000 },
                        { item: 'Services', y2024: 96169.0, pct2024: 100.000, y2023: 85200.0, pct2023: 100.000 },
                        { item: 'Total Net Sales', y2024: 391035.0, pct2024: 100.000, y2023: 383285.0, pct2023: 100.000 },
                        { item: 'Products', y2024: 185233.0, pct2024: 47.370, y2023: 189282.0, pct2023: 49.384 },
                        { item: 'Services', y2024: 25119.0, pct2024: 6.424, y2023: 24855.0, pct2023: 6.485 },
                        { item: 'Total Cost of Sales', y2024: 210352.0, pct2024: 53.794, y2023: 214137.0, pct2023: 55.869 },
                        { item: 'Gross Margin', y2024: 180683.0, pct2024: 46.206, y2023: 169148.0, pct2023: 44.131 },
                        { item: 'Research & development', y2024: 31370.0, pct2024: 8.022, y2023: 29915.0, pct2023: 7.805 },
                        { item: 'Selling, general and administrative', y2024: 26097.0, pct2024: 6.674, y2023: 24932.0, pct2023: 6.505 },
                        { item: 'Total Operating expenses', y2024: 57467.0, pct2024: 14.696, y2023: 54847.0, pct2023: 14.310 },
                        { item: 'Income from operations', y2024: 123216.0, pct2024: 31.510, y2023: 114301.0, pct2023: 29.821 },
                        { item: 'Other income (expense), net', y2024: 269.0, pct2024: 0.069, y2023: -565.0, pct2023: -0.147 },
                        { item: 'Income before income taxes', y2024: 123485.0, pct2024: 31.579, y2023: 113736.0, pct2023: 29.674 },
                        { item: 'Provision for income taxes', y2024: 29749.0, pct2024: 7.608, y2023: 16741.0, pct2023: 4.368 },
                        { item: 'Net Income', y2024: 93736.0, pct2024: 23.971, y2023: 96995.0, pct2023: 25.306 }
                    ]
                },
                trend: {
                    revenue: { 2022: 394328.0, 2023: 383285.0, 2024: 391035.0 },
                    netIncome: { 2022: 99803.0, 2023: 96995.0, 2024: 93736.0 },
                    operatingCashFlow: { 2022: 122151, 2023: 110543, 2024: 118254 }
                }
            },
            ratios: {
                2023: {
                    liquidity: [
                        { 
                            name: 'Working Capital',
                            description: 'How many dollars of current assets is available for every dollar of current liabilities',
                            formula: 'Current Assets - Current Liabilities',
                            alphabet: { calculation: 'Current Assets: $171,530\nCurrent Liabilities: $81,814\n= $89,716', value: 89716 },
                            meta: { calculation: 'Current Assets: $85,365\nCurrent Liabilities: $31,960\n= $53,405', value: 53405 }, apple: { calculation: 'Current Assets: $143,566\nCurrent Liabilities: $145,308\n= $-1,742', value: -1742.0 }
                        },
                        {
                            name: 'Cash Ratio',
                            description: 'How many dollars of cash is available for every dollar of current liabilities',
                            formula: 'Cash and Cash Equivalents / Current Liabilities',
                            alphabet: { calculation: 'Cash: $24,048\nCurrent Liabilities: $81,814\n= 0.29', value: 0.294 },
                            meta: { calculation: 'Cash: $41,862\nCurrent Liabilities: $31,960\n= 1.31', value: 1.310 }, apple: { calculation: '29965', value: 0.20621713876730807 }
                        },
                        {
                            name: 'Acid-Test Ratio',
                            description: 'How many dollars of liquid assets is available for every dollar of current liabilities',
                            formula: 'Cash + Marketable Securities + Net Accounts Receivable / Current Liabilities',
                            alphabet: { calculation: 'Cash + Marketable Sec. + A/R: $158,880\nCurrent Liabilities: $81,814\n= 1.94', value: 1.942 },
                            meta: { calculation: 'Cash + Marketable Sec. + A/R: $81,572\nCurrent Liabilities: $31,960\n= 2.55', value: 2.552 }, apple: { calculation: '122540', value: 0.8433121369780053 }
                        },
                        {
                            name: 'Current Ratio',
                            description: 'How many dollars of current assets is available for every dollar of current liabilities',
                            formula: 'Current Assets / Current Liabilities',
                            alphabet: { calculation: 'Current Assets: $171,530\nCurrent Liabilities: $81,814\n= 2.10', value: 2.097 },
                            meta: { calculation: 'Current Assets: $85,365\nCurrent Liabilities: $31,960\n= 2.67', value: 2.671 }, apple: { calculation: '143566', value: 0.9880116717592975 }
                        }
                    ],
                    activity: [
                        {
                            name: 'Inventory Turnover',
                            description: 'How many times inventory is sold and replaced',
                            formula: 'Cost of goods sold / Average Inventory',
                            alphabet: { calculation: 'N/A - Tech company with minimal inventory', value: null, display: 'N/A' },
                            meta: { calculation: 'N/A - Tech company with minimal inventory', value: null, display: 'N/A' }, apple: { calculation: 'Cost of Goods Sold: $189,282\nAverage Inventory: $5,638.5\n= 33.57x', value: 33.569566374035645, display: '33.57x' }
                        },
                        {
                            name: "Days' Sales in Inventory",
                            description: 'The average number of days inventory is held by a company',
                            formula: '365 days / Inventory Turnover',
                            alphabet: { calculation: 'N/A - Tech company with minimal inventory', value: null, display: 'N/A' },
                            meta: { calculation: 'N/A - Tech company with minimal inventory', value: null, display: 'N/A' }, apple: { calculation: '365 days\nTurnover: 33.57\n= 10.9 days', value: 10.872943544552573, display: '10.9 days' }
                        },
                        {
                            name: 'Gross Profit Percentage',
                            description: 'Gross profit generated for every $1 of Revenue',
                            formula: 'Gross Profit / Net Sales Revenue',
                            alphabet: { calculation: 'Gross Profit: $174,062\nNet Sales Revenue: $307,394\n= 56.6%', value: 0.566, display: '56.6%' },
                            meta: { calculation: 'Gross Profit: $108,943\nNet Sales Revenue: $134,902\n= 80.8%', value: 0.808, display: '80.8%' }, apple: { calculation: 'Gross Profit: $169,148\nNet Sales Revenue: $383,285\n= 44.1%', value: 0.4413112957720756, display: '44.1%' }
                        },
                        {
                            name: 'Accounts Receivable Turnover',
                            description: 'How many times receivables are collected and converted into cash',
                            formula: 'Net Credit Sales / Average Accounts Receivable',
                            alphabet: { calculation: 'Net Credit Sales: $307,394\nAverage A/R: $44,111\n= 6.97x', value: 6.97, display: '6.97x' },
                            meta: { calculation: 'Net Credit Sales: $134,902\nAverage A/R: $14,817.5\n= 9.10x', value: 9.10, display: '9.10x' }, apple: { calculation: 'Net Credit Sales: $383,285\nAverage A/R: $60,958.5\n= 6.29x', value: 6.287638311310154, display: '6.29x' }
                        },
                        {
                            name: "Days' Sales in Receivables",
                            description: 'The average number of days it takes to collect receivables',
                            formula: '365 days / Accounts Receivable Turnover Ratio',
                            alphabet: { calculation: '365 days\nA/R Turnover: 6.969\n= 52.4 days', value: 52.4, display: '52.4 days' },
                            meta: { calculation: '365 days\nA/R Turnover: 9.104\n= 40.1 days', value: 40.1, display: '40.1 days' }, apple: { calculation: '365 days\nTurnover: 6.29\n= 58.1 days', value: 58.0504128781455, display: '58.1 days' }
                        }
                    ],
                    solvency: [
                        {
                            name: 'Debt to Asset Ratio',
                            description: 'The percentage of total assets provided by creditors',
                            formula: 'Total Liabilities / Total Assets',
                            alphabet: { calculation: 'Total Liabilities: $119,013\nTotal Assets: $402,392\n= 29.6%', value: 0.296, display: '29.6%' },
                            meta: { calculation: 'Total Liabilities: $76,455\nTotal Assets: $229,623\n= 33.3%', value: 0.333, display: '33.3%' }, apple: { calculation: 'Total Liabilities: $290,437\nTotal Assets: $352,583\n= 82.4%', value: 0.8237407929480435, display: '82.4%' }
                        },
                        {
                            name: 'Debt to Equity Ratio',
                            description: 'How many dollars of debt for every dollar of equity',
                            formula: 'Total Liabilities / Total Stockholders Equity',
                            alphabet: { calculation: 'Total Liabilities: $119,013\nTotal Equity: $283,379\n= 0.42x', value: 0.420, display: '0.42x' },
                            meta: { calculation: 'Total Liabilities: $76,455\nTotal Equity: $153,168\n= 0.50x', value: 0.499, display: '0.50x' }, apple: { calculation: 'Total Liabilities: $290,437\nTotal Equity: $62,146\n= 4.67x', value: 4.673462491552152, display: '4.67x' }
                        },
                        {
                            name: 'Times Interest Earned',
                            description: "Measures a company's ability to make its interest payments",
                            formula: 'Operating Income / Interest Expense',
                            alphabet: { calculation: 'Operating Income: $84,293\nInterest Expense: $308\n= 273.68x', value: 273.68, display: '273.68x' },
                            meta: { calculation: 'Operating Income: $46,751\nInterest Expense: $446\n= 104.82x', value: 104.82, display: '104.82x' }, apple: { calculation: 'Operating Income: $114,301\nInterest Expense: $4,000\n= 28.58x', value: 28.57525, display: '28.58x' }
                        }
                    ],
                    profitability: [
                        {
                            name: 'Profit Margin on Sales',
                            description: 'Net income generated for every dollar of sales',
                            formula: 'Net Income / Net Sales',
                            alphabet: { calculation: 'Net Income: $73,795\nNet Sales: $307,394\n= 24.0%', value: 0.240, display: '24.0%' },
                            meta: { calculation: 'Net Income: $39,098\nNet Sales: $134,902\n= 29.0%', value: 0.290, display: '29.0%' }, apple: { calculation: 'Net Income: $96,995\nNet Sales: $383,285\n= 25.3%', value: 0.2530623426432028, display: '25.3%' }
                        },
                        {
                            name: 'Return on Assets',
                            description: 'Net income generated for every dollar of assets',
                            formula: '(Net Income + Interest expense) / Average Total Assets',
                            alphabet: { calculation: 'Net Income + Interest: $74,103\nAverage Total Assets: $383,828\n= 19.3%', value: 0.193, display: '19.3%' },
                            meta: { calculation: 'Net Income + Interest: $39,544\nAverage Total Assets: $207,675\n= 19.0%', value: 0.190, display: '19.0%' }, apple: { calculation: 'Net Income + Interest: $100,995\nAverage Total Assets: $352,669\n= 28.6%', value: 0.2863733415752448, display: '28.6%' }
                        },
                        {
                            name: 'Asset Turnover',
                            description: 'How efficiently assets are being used to generate sales',
                            formula: 'Net Sales / Average Total Assets',
                            alphabet: { calculation: 'Net Sales: $307,394\nAverage Total Assets: $383,828\n= 0.80x', value: 0.801, display: '0.80x' },
                            meta: { calculation: 'Net Sales: $134,902\nAverage Total Assets: $207,675\n= 0.65x', value: 0.650, display: '0.65x' }, apple: { calculation: 'Net Sales: $383,285\nAverage Total Assets: $352,669\n= 1.09x', value: 1.0868122800699807, display: '1.09x' }
                        },
                        {
                            name: 'Return on Equity',
                            description: 'Net income generated for every dollar of equity',
                            formula: 'Net Income / Average Total Equity',
                            alphabet: { calculation: 'Net Income: $73,795\nAverage Total Equity: $269,761.5\n= 27.4%', value: 0.274, display: '27.4%' },
                            meta: { calculation: 'Net Income: $39,098\nAverage Total Equity: $139,440.5\n= 28.0%', value: 0.280, display: '28.0%' }, apple: { calculation: 'Net Income: $96,995\nAverage Total Equity: $56,409\n= 171.9%', value: 1.7194951160275842, display: '171.9%' }
                        },
                        {
                            name: 'Earnings Per Share',
                            description: 'Profit earned for each share of outstanding shares',
                            formula: '(Net Income - Preferred Dividends) / Weighted Average Common Shares Outstanding',
                            alphabet: { calculation: 'Net Income: $73,795\nWeighted Avg Shares: 12,722\n= $5.80', value: 5.80, display: '$5.80' },
                            meta: { calculation: 'Net Income: $39,098\nWeighted Avg Shares: 2,629\n= $14.87', value: 14.87, display: '$14.87' }, apple: { calculation: 'Net Income: $96,995\nWeighted Avg Shares: 15,812\n= $6.13', value: 6.134265115102454, display: '$6.13' }
                        }
                    ],
                    investment: [
                        {
                            name: 'PE Ratio',
                            description: 'How much an investor must pay for a share of current and future earnings',
                            formula: 'Market Price Per share / Earnings Per share',
                            alphabet: { calculation: 'Market Price: $315.81\nEPS: $5.80\n= 54.44x', value: 54.44, display: '54.44x' },
                            meta: { calculation: 'Market Price: $640.87\nEPS: $14.87\n= 43.09x', value: 43.09, display: '43.09x' }, apple: { calculation: 'Market Price: $286.19\nEPS: $6.13\n= 46.65x', value: 46.65432527449868, display: '46.65x' }
                        },
                        {
                            name: 'Dividend Yield',
                            description: 'How much an investor receives in dividends for every $1 paid for stock',
                            formula: 'Annual dividend per share / Market Price Per share',
                            alphabet: { calculation: 'Annual Dividend: $0.00\nMarket Price: $315.81\n= 0.00%', value: 0.000, display: '0.00%' },
                            meta: { calculation: 'Annual Dividend: $0.00\nMarket Price: $640.87\n= 0.00%', value: 0.000, display: '0.00%' }, apple: { calculation: 'Annual Dividend: $0.95\nMarket Price: $286.19\n= 0.33%', value: 0.0033194730773262516, display: '0.33%' }
                        },
                        {
                            name: 'Dividend Payout',
                            description: 'How much of the EPS is paid out in dividends',
                            formula: 'Annual dividend per share / Earnings Per Share',
                            alphabet: { calculation: 'Annual Dividend: $0.00\nEPS: $5.80\n= 0.0%', value: 0.000, display: '0.0%' },
                            meta: { calculation: 'Annual Dividend: $0.00\nEPS: $14.87\n= 0.0%', value: 0.000, display: '0.0%' }, apple: { calculation: 'Annual Dividend: $0.95\nEPS: $6.13\n= 15.5%', value: 0.15486777668952006, display: '15.5%' }
                        }
                    ]
                },
                2024: {
                liquidity: [
                    { 
                        name: 'Working Capital',
                        description: 'How many dollars of current assets is available for every dollar of current liabilities',
                        formula: 'Current Assets - Current Liabilities',
                        alphabet: { calculation: 'Current Assets: $163,711\nCurrent Liabilities: $89,122\n= $74,589', value: 74589 },
                        meta: { calculation: 'Current Assets: $100,045\nCurrent Liabilities: $33,596\n= $66,449', value: 66449 }, apple: { calculation: 'Current Assets: $152,987\nCurrent Liabilities: $176,392\n= $-23,405', value: -23405.0 }
                    },
                    {
                        name: 'Cash Ratio',
                        description: 'How many dollars of cash is available for every dollar of current liabilities',
                        formula: 'Cash and Cash Equivalents / Current Liabilities',
                        alphabet: { calculation: 'Cash: $23,466\nCurrent Liabilities: $89,122\n= 0.26', value: 0.263 },
                        meta: { calculation: 'Cash: $43,889\nCurrent Liabilities: $33,596\n= 1.31', value: 1.306 }, apple: { calculation: '29943', value: 0.16975259648963673 }
                    },
                    {
                        name: 'Acid-Test Ratio',
                        description: 'How many dollars of liquid assets is available for every dollar of current liabilities',
                        formula: 'Cash + Marketable Securities + Net Accounts Receivable / Current Liabilities',
                        alphabet: { calculation: 'Cash + Marketable Sec. + A/R: $147,997\nCurrent Liabilities: $89,122\n= 1.66', value: 1.661 },
                        meta: { calculation: 'Cash + Marketable Sec. + A/R: $94,809\nCurrent Liabilities: $33,596\n= 2.82', value: 2.822 }, apple: { calculation: '131414', value: 0.7450111116150392 }
                    },
                    {
                        name: 'Current Ratio',
                        description: 'How many dollars of current assets is available for every dollar of current liabilities',
                        formula: 'Current Assets / Current Liabilities',
                        alphabet: { calculation: 'Current Assets: $163,711\nCurrent Liabilities: $89,122\n= 1.84', value: 1.837 },
                        meta: { calculation: 'Current Assets: $100,045\nCurrent Liabilities: $33,596\n= 2.98', value: 2.978 }, apple: { calculation: '152987', value: 0.8673125765340832 }
                    }
                ],
                activity: [
                    {
                        name: 'Inventory Turnover',
                        description: 'How many times inventory is sold and replaced',
                        formula: 'Cost of goods sold / Average Inventory',
                        alphabet: { calculation: 'N/A - Tech company with minimal inventory', value: null, display: 'N/A' },
                        meta: { calculation: 'N/A - Tech company with minimal inventory', value: null, display: 'N/A' }, apple: { calculation: 'Cost of Goods Sold: $185,233\nAverage Inventory: $6,808.5\n= 27.21x', value: 27.206139384592788, display: '27.21x' }
                    },
                    {
                        name: "Days' Sales in Inventory",
                        description: 'The average number of days inventory is held by a company',
                        formula: '365 days / Inventory Turnover',
                        alphabet: { calculation: 'N/A - Tech company with minimal inventory', value: null, display: 'N/A' },
                        meta: { calculation: 'N/A - Tech company with minimal inventory', value: null, display: 'N/A' }, apple: { calculation: '365 days\nTurnover: 27.21\n= 13.4 days', value: 13.416089465699956, display: '13.4 days' }
                    },
                    {
                        name: 'Gross Profit Percentage',
                        description: 'Gross profit generated for every $1 of Revenue',
                        formula: 'Gross Profit / Net Sales Revenue',
                        alphabet: { calculation: 'Gross Profit: $203,712\nNet Sales Revenue: $350,018\n= 58.2%', value: 0.582, display: '58.2%' },
                        meta: { calculation: 'Gross Profit: $134,340\nNet Sales Revenue: $164,501\n= 81.7%', value: 0.817, display: '81.7%' }, apple: { calculation: 'Gross Profit: $180,683\nNet Sales Revenue: $391,035\n= 46.2%', value: 0.4620634981523393, display: '46.2%' }
                    },
                    {
                        name: 'Accounts Receivable Turnover',
                        description: 'How many times receivables are collected and converted into cash',
                        formula: 'Net Credit Sales / Average Accounts Receivable',
                        alphabet: { calculation: 'Net Credit Sales: $350,018\nAverage A/R: $50,152\n= 6.98x', value: 6.98, display: '6.98x' },
                        meta: { calculation: 'Net Credit Sales: $164,501\nAverage A/R: $16,581.5\n= 9.92x', value: 9.92, display: '9.92x' }, apple: { calculation: 'Net Credit Sales: $391,035\nAverage A/R: $63,614\n= 6.15x', value: 6.146995944288993, display: '6.15x' }
                    },
                    {
                        name: "Days' Sales in Receivables",
                        description: 'The average number of days it takes to collect receivables',
                        formula: '365 days / Accounts Receivable Turnover Ratio',
                        alphabet: { calculation: '365 days\nA/R Turnover: 6.979\n= 52.3 days', value: 52.3, display: '52.3 days' },
                        meta: { calculation: '365 days\nA/R Turnover: 9.921\n= 36.8 days', value: 36.8, display: '36.8 days' }, apple: { calculation: '365 days\nTurnover: 6.15\n= 59.4 days', value: 59.37859782372422, display: '59.4 days' }
                    }
                ],
                solvency: [
                    {
                        name: 'Debt to Asset Ratio',
                        description: 'The percentage of total assets provided by creditors',
                        formula: 'Total Liabilities / Total Assets',
                        alphabet: { calculation: 'Total Liabilities: $125,172\nTotal Assets: $450,256\n= 27.8%', value: 0.278, display: '27.8%' },
                        meta: { calculation: 'Total Liabilities: $93,417\nTotal Assets: $276,054\n= 33.8%', value: 0.338, display: '33.8%' }, apple: { calculation: 'Total Liabilities: $308,030\nTotal Assets: $364,980\n= 84.4%', value: 0.8439640528248123, display: '84.4%' }
                    },
                    {
                        name: 'Debt to Equity Ratio',
                        description: 'How many dollars of debt for every dollar of equity',
                        formula: 'Total Liabilities / Total Stockholders Equity',
                        alphabet: { calculation: 'Total Liabilities: $125,172\nTotal Equity: $325,084\n= 0.39x', value: 0.385, display: '0.39x' },
                        meta: { calculation: 'Total Liabilities: $93,417\nTotal Equity: $182,637\n= 0.51x', value: 0.511, display: '0.51x' }, apple: { calculation: 'Total Liabilities: $308,030\nTotal Equity: $56,950\n= 5.41x', value: 5.408779631255487, display: '5.41x' }
                    },
                    {
                        name: 'Times Interest Earned',
                        description: "Measures a company's ability to make its interest payments",
                        formula: 'Operating Income / Interest Expense',
                        alphabet: { calculation: 'Operating Income: $112,390\nInterest Expense: $268\n= 419.37x', value: 419.37, display: '419.37x' },
                        meta: { calculation: 'Operating Income: $69,380\nInterest Expense: $715\n= 97.03x', value: 97.03, display: '97.03x' }, apple: { calculation: 'Operating Income: $123,216\nInterest Expense: $4,000\n= 30.80x', value: 30.804, display: '30.80x' }
                    }
                ],
                profitability: [
                    {
                        name: 'Profit Margin on Sales',
                        description: 'Net income generated for every dollar of sales',
                        formula: 'Net Income / Net Sales',
                        alphabet: { calculation: 'Net Income: $100,118\nNet Sales: $350,018\n= 28.6%', value: 0.286, display: '28.6%' },
                        meta: { calculation: 'Net Income: $62,360\nNet Sales: $164,501\n= 37.9%', value: 0.379, display: '37.9%' }, apple: { calculation: 'Net Income: $93,736\nNet Sales: $391,035\n= 24.0%', value: 0.23971255769943867, display: '24.0%' }
                    },
                    {
                        name: 'Return on Assets',
                        description: 'Net income generated for every dollar of assets',
                        formula: '(Net Income + Interest expense) / Average Total Assets',
                        alphabet: { calculation: 'Net Income + Interest: $100,386\nAverage Total Assets: $426,324\n= 23.5%', value: 0.235, display: '23.5%' },
                        meta: { calculation: 'Net Income + Interest: $63,075\nAverage Total Assets: $252,838.5\n= 24.9%', value: 0.249, display: '24.9%' }, apple: { calculation: 'Net Income + Interest: $97,736\nAverage Total Assets: $358,781.5\n= 27.2%', value: 0.2724109241975966, display: '27.2%' }
                    },
                    {
                        name: 'Asset Turnover',
                        description: 'How efficiently assets are being used to generate sales',
                        formula: 'Net Sales / Average Total Assets',
                        alphabet: { calculation: 'Net Sales: $350,018\nAverage Total Assets: $426,324\n= 0.82x', value: 0.821, display: '0.82x' },
                        meta: { calculation: 'Net Sales: $164,501\nAverage Total Assets: $252,838.5\n= 0.65x', value: 0.651, display: '0.65x' }, apple: { calculation: 'Net Sales: $391,035\nAverage Total Assets: $358,781.5\n= 1.09x', value: 1.0898973330564703, display: '1.09x' }
                    },
                    {
                        name: 'Return on Equity',
                        description: 'Net income generated for every dollar of equity',
                        formula: 'Net Income / Average Total Equity',
                        alphabet: { calculation: 'Net Income: $100,118\nAverage Total Equity: $304,231.5\n= 32.9%', value: 0.329, display: '32.9%' },
                        meta: { calculation: 'Net Income: $62,360\nAverage Total Equity: $167,902.5\n= 37.1%', value: 0.371, display: '37.1%' }, apple: { calculation: 'Net Income: $93,736\nAverage Total Equity: $59,548\n= 157.4%', value: 1.5741250755692886, display: '157.4%' }
                    },
                    {
                        name: 'Earnings Per Share',
                        description: 'Profit earned for each share of outstanding shares',
                        formula: '(Net Income - Preferred Dividends) / Weighted Average Common Shares Outstanding',
                        alphabet: { calculation: 'Net Income: $100,118\nWeighted Avg Shares: 12,447\n= $8.04', value: 8.04, display: '$8.04' },
                        meta: { calculation: 'Net Income: $62,360\nWeighted Avg Shares: 2,614\n= $23.86', value: 23.86, display: '$23.86' }, apple: { calculation: 'Net Income: $93,736\nWeighted Avg Shares: 15,408\n= $6.08', value: 6.083592938733125, display: '$6.08' }
                    }
                ],
                investment: [
                    {
                        name: 'PE Ratio',
                        description: 'How much an investor must pay for a share of current and future earnings',
                        formula: 'Market Price Per share / Earnings Per share',
                        alphabet: { calculation: 'Market Price: $315.81\nEPS: $8.04\n= 39.26x', value: 39.26, display: '39.26x' },
                        meta: { calculation: 'Market Price: $640.87\nEPS: $23.86\n= 26.86x', value: 26.86, display: '26.86x' }, apple: { calculation: 'Market Price: $286.19\nEPS: $6.08\n= 47.04x', value: 47.042923956644195, display: '47.04x' }
                    },
                    {
                        name: 'Dividend Yield',
                        description: 'How much an investor receives in dividends for every $1 paid for stock',
                        formula: 'Annual dividend per share / Market Price Per share',
                        alphabet: { calculation: 'Annual Dividend: $0.60\nMarket Price: $315.81\n= 0.19%', value: 0.0019, display: '0.19%' },
                        meta: { calculation: 'Annual Dividend: $2.00\nMarket Price: $640.87\n= 0.31%', value: 0.0031, display: '0.31%' }, apple: { calculation: 'Annual Dividend: $0.99\nMarket Price: $286.19\n= 0.35%', value: 0.0034592403647926203, display: '0.35%' }
                    },
                    {
                        name: 'Dividend Payout',
                        description: 'How much of the EPS is paid out in dividends',
                        formula: 'Annual dividend per share / Earnings Per Share',
                        alphabet: { calculation: 'Annual Dividend: $0.60\nEPS: $8.04\n= 7.5%', value: 0.075, display: '7.5%' },
                        meta: { calculation: 'Annual Dividend: $2.00\nEPS: $23.86\n= 8.4%', value: 0.084, display: '8.4%' }, apple: { calculation: 'Annual Dividend: $0.99\nEPS: $6.08\n= 16.3%', value: 0.16273278142869335, display: '16.3%' }
                    }
                ]
            }
        }
        };

        let currentCompany = 'alphabet';
        let currentAnalysis = 'horizontal';
        let currentPeriod = '2022-2023';
        let currentRatioYear = '2024';
        let currentComparison = ''; // For comparison mode

        // Initialize

        // FINANCIAL DETECTIVE GAME
// FINANCIAL DETECTIVE QUESTION BANK
const GAME_QUESTIONS = {
    level1: [
        {
            id: 'L1Q1',
            question: 'Which company has the highest revenue in 2024?',
            options: ['Alphabet', 'Meta', 'Apple'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple has the highest revenue in 2024 at $391.0 billion.',
                data: '‚Ä¢ Apple: $391.0B\n‚Ä¢ Alphabet: $350.0B\n‚Ä¢ Meta: $164.5B',
                location: 'Go to: Trend Analysis ‚Üí Revenue row ‚Üí 2024 column',
                insight: 'Despite Apple\'s high revenue, notice Alphabet has higher net income ($100.1B vs $93.7B). Revenue ‚â† Profit!'
            }
        },
        {
            id: 'L1Q2',
            question: 'What is Alphabet\'s current ratio for 2024?',
            options: ['1.84', '2.98', '0.87'],
            correct: 0, // 1.84
            explanation: {
                answer: 'Alphabet\'s current ratio for 2024 is 1.84.',
                data: 'Current Ratios (2024):\n‚Ä¢ Alphabet: 1.84\n‚Ä¢ Meta: 2.98\n‚Ä¢ Apple: 0.87',
                location: 'Select Alphabet ‚Üí Financial Ratios (2024) ‚Üí "Ability to Pay Current Liabilities" ‚Üí Current Ratio',
                insight: 'A current ratio of 1.84 means Alphabet has $1.84 in current assets for every $1.00 in current liabilities. This indicates good short-term financial health.'
            }
        },
        {
            id: 'L1Q3',
            question: 'Which company has negative working capital in 2024?',
            options: ['Alphabet', 'Meta', 'Apple'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple has negative working capital in 2024 at -$23,405 million.',
                data: 'Working Capital (2024):\n‚Ä¢ Alphabet: $74,589M\n‚Ä¢ Meta: $66,449M\n‚Ä¢ Apple: -$23,405M',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Pay Current Liabilities" ‚Üí Working Capital',
                insight: 'Negative working capital is actually OKAY for Apple! It shows efficient cash management - they collect from customers before paying suppliers.'
            }
        },
        {
            id: 'L1Q4',
            question: 'What is Meta\'s P/E ratio in 2024?',
            options: ['39.26x', '26.86x', '47.04x'],
            correct: 1, // 26.86x
            explanation: {
                answer: 'Meta\'s P/E ratio in 2024 is 26.86x.',
                data: 'P/E Ratios (2024):\n‚Ä¢ Alphabet: 39.26x\n‚Ä¢ Meta: 26.86x\n‚Ä¢ Apple: 47.04x',
                location: 'Select Meta ‚Üí Financial Ratios (2024) ‚Üí "Stock as Investment" ‚Üí PE Ratio',
                insight: 'Meta has the lowest P/E ratio despite being the fastest-growing company. This suggests Meta may be undervalued by the market!'
            }
        },
        {
            id: 'L1Q5',
            question: 'Which company has the highest gross profit percentage in 2024?',
            options: ['Alphabet', 'Meta', 'Apple'],
            correct: 1, // Meta
            explanation: {
                answer: 'Meta has the highest gross profit percentage in 2024 at 81.7%.',
                data: 'Gross Profit % (2024):\n‚Ä¢ Meta: 81.7%\n‚Ä¢ Alphabet: 58.2%\n‚Ä¢ Apple: 46.2%',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Sell Inventory and Collect Receivables" ‚Üí Gross Profit Percentage',
                insight: 'Meta\'s 81.7% gross margin reflects its software/platform business model with very low cost of goods sold. Compare this to Apple\'s 46.2% which includes hardware manufacturing costs.'
            }
        },
        {
            id: 'L1Q6',
            question: 'Which company paid the highest dividend per share in 2024?',
            options: ['Alphabet ($0.60)', 'Meta ($2.00)', 'Apple ($0.99)'],
            correct: 1, // Meta
            explanation: {
                answer: 'Meta paid the highest dividend per share in 2024 at $2.00.',
                data: 'Annual Dividends (2024):\n‚Ä¢ Meta: $2.00\n‚Ä¢ Apple: $0.99\n‚Ä¢ Alphabet: $0.60',
                location: 'Financial Ratios (2024) ‚Üí "Stock as Investment" ‚Üí Check the dividend values',
                insight: 'Both Alphabet and Meta started paying dividends in 2024 for the first time! This signals their transition to more mature companies returning cash to shareholders.'
            }
        },
        {
            id: 'L1Q7',
            question: 'What is Alphabet\'s ROE (Return on Equity) for 2024?',
            options: ['32.9%', '37.1%', '157.4%'],
            correct: 0, // 32.9%
            explanation: {
                answer: 'Alphabet\'s ROE for 2024 is 32.9%.',
                data: 'ROE (2024):\n‚Ä¢ Alphabet: 32.9%\n‚Ä¢ Meta: 37.1%\n‚Ä¢ Apple: 157.4%',
                location: 'Select Alphabet ‚Üí Financial Ratios (2024) ‚Üí "Profitability" ‚Üí Return on Equity',
                insight: 'ROE shows how much profit a company generates with shareholder equity. Apple\'s exceptionally high ROE (157.4%) is driven by massive stock buybacks that reduce the equity base.'
            }
        },
        {
            id: 'L1Q8',
            question: 'Which company has the lowest debt to equity ratio in 2024?',
            options: ['Alphabet (0.42x)', 'Meta (0.50x)', 'Apple (5.41x)'],
            correct: 0, // Alphabet
            explanation: {
                answer: 'Alphabet has the lowest debt to equity ratio at 0.42x.',
                data: 'Debt to Equity (2024):\n‚Ä¢ Alphabet: 0.42x\n‚Ä¢ Meta: 0.50x\n‚Ä¢ Apple: 5.41x',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Pay Long-Term Debt" ‚Üí Debt to Equity Ratio',
                insight: 'Lower debt-to-equity means less financial risk. Apple\'s high ratio (5.41x) reflects their strategy of using debt while returning equity to shareholders through buybacks.'
            }
        },
        {
            id: 'L1Q9',
            question: 'What is Meta\'s EPS (Earnings Per Share) for 2024?',
            options: ['$8.04', '$23.86', '$6.08'],
            correct: 1, // $23.86
            explanation: {
                answer: 'Meta\'s EPS for 2024 is $23.86.',
                data: 'EPS (2024):\n‚Ä¢ Meta: $23.86\n‚Ä¢ Alphabet: $8.04\n‚Ä¢ Apple: $6.08',
                location: 'Select Meta ‚Üí Financial Ratios (2024) ‚Üí "Profitability" ‚Üí Earnings Per Share',
                insight: 'Meta has the highest EPS because they have fewer shares outstanding. This is why we use P/E ratio (price divided by EPS) to compare valuations across companies with different share counts.'
            }
        },
        {
            id: 'L1Q10',
            question: 'Which company has the fastest inventory turnover in 2024?',
            options: ['Alphabet (N/A)', 'Meta (N/A)', 'Apple (27.21x)'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple has inventory turnover of 27.21x in 2024 (Alphabet and Meta have no inventory as software companies).',
                data: 'Inventory Turnover (2024):\n‚Ä¢ Apple: 27.21x\n‚Ä¢ Alphabet: N/A (no inventory)\n‚Ä¢ Meta: N/A (no inventory)',
                location: 'Select Apple ‚Üí Financial Ratios (2024) ‚Üí "Ability to Sell Inventory" ‚Üí Inventory Turnover',
                insight: 'Apple sells and replaces inventory 27 times per year (about every 13 days). This shows incredibly efficient supply chain management!'
            }
        },
        {
            id: 'L1Q11',
            question: 'What is Apple\'s profit margin for 2024?',
            options: ['19.3%', '24.0%', '29.0%'],
            correct: 1, // 24.0%
            explanation: {
                answer: 'Apple\'s profit margin for 2024 is 24.0%.',
                data: 'Profit Margins (2024):\n‚Ä¢ Meta: 29.0%\n‚Ä¢ Apple: 24.0%\n‚Ä¢ Alphabet: 23.1%',
                location: 'Select Apple ‚Üí Financial Ratios (2024) ‚Üí "Profitability" ‚Üí Profit Margin on Sales',
                insight: 'A 24% profit margin means Apple keeps $0.24 profit for every $1.00 in sales. Meta\'s higher margin (29%) reflects the lower costs of running a digital platform vs manufacturing hardware.'
            }
        },
        {
            id: 'L1Q12',
            question: 'Which company has the highest total net income in 2024?',
            options: ['Alphabet ($100.1B)', 'Meta ($62.4B)', 'Apple ($93.7B)'],
            correct: 0, // Alphabet
            explanation: {
                answer: 'Alphabet has the highest net income in 2024 at $100.1 billion.',
                data: 'Net Income (2024):\n‚Ä¢ Alphabet: $100.1B\n‚Ä¢ Apple: $93.7B\n‚Ä¢ Meta: $62.4B',
                location: 'Trend Analysis ‚Üí Net Income row ‚Üí 2024 column',
                insight: 'Alphabet earns more profit than Apple despite having lower revenue ($350B vs $391B). This shows Alphabet\'s strong profit margins and efficient operations.'
            }
        },
        {
            id: 'L1Q13',
            question: 'What is Alphabet\'s operating cash flow for 2024?',
            options: ['$125B', '$71.1B', '$118.3B'],
            correct: 0, // $125B
            explanation: {
                answer: 'Alphabet\'s operating cash flow for 2024 is $125 billion.',
                data: 'Operating Cash Flow (2024):\n‚Ä¢ Alphabet: $125B\n‚Ä¢ Apple: $118.3B\n‚Ä¢ Meta: Not displayed',
                location: 'Select Alphabet ‚Üí Trend Analysis ‚Üí Operating Cash Flow row ‚Üí 2024',
                insight: 'Operating cash flow shows actual cash generated from business operations. Alphabet\'s strong operating cash flow of $125B demonstrates excellent operational efficiency.'
            }
        },
        {
            id: 'L1Q14',
            question: 'Which company showed the highest revenue growth rate from 2023 to 2024?',
            options: ['Alphabet (13.9%)', 'Meta (21.9%)', 'Apple (2.0%)'],
            correct: 1, // Meta
            explanation: {
                answer: 'Meta showed the highest revenue growth at 21.9% from 2023 to 2024.',
                data: 'Revenue Growth (2023‚Üí2024):\n‚Ä¢ Meta: +21.9% ($134.9B ‚Üí $164.5B)\n‚Ä¢ Alphabet: +13.9% ($307.4B ‚Üí $350.0B)\n‚Ä¢ Apple: +2.0% ($383.3B ‚Üí $391.0B)',
                location: 'Horizontal Analysis (2023-2024) ‚Üí Total Net Sales/Revenue line',
                insight: 'Meta\'s 21.9% growth is remarkable for a company of its size, driven by strong advertising demand and AI initiatives. Apple\'s slower growth (2%) is typical for very mature companies.'
            }
        },
        {
            id: 'L1Q15',
            question: 'True or False: All three companies have a current ratio above 1.0 in 2024.',
            options: ['True', 'False'],
            correct: 1, // False
            explanation: {
                answer: 'False. Apple\'s current ratio is 0.87, which is below 1.0.',
                data: 'Current Ratios (2024):\n‚Ä¢ Meta: 2.98 ‚úì\n‚Ä¢ Alphabet: 1.84 ‚úì\n‚Ä¢ Apple: 0.87 ‚úó (below 1.0)',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Pay Current Liabilities" ‚Üí Current Ratio',
                insight: 'While a current ratio below 1.0 usually signals liquidity problems, Apple is an exception. Their business model allows them to operate efficiently with negative working capital.'
            }
        }
    ],
    
    level2: [
        {
            id: 'L2Q1',
            question: 'Rank these companies by ROE (Return on Equity) from HIGHEST to LOWEST:',
            type: 'ranking',
            options: ['Apple (157.4%)', 'Meta (37.1%)', 'Alphabet (32.9%)'],
            correct: [0, 1, 2], // Apple, Meta, Alphabet
            explanation: {
                answer: 'Correct ranking: Apple (157.4%), Meta (37.1%), Alphabet (32.9%)',
                data: 'ROE 2024:\n‚Ä¢ Apple: 157.4% (HIGHEST)\n‚Ä¢ Meta: 37.1%\n‚Ä¢ Alphabet: 32.9%',
                location: 'Financial Ratios (2024) ‚Üí "Profitability" ‚Üí Return on Equity for each company',
                insight: 'Apple\'s extraordinarily high ROE (157.4%) is driven by aggressive stock buybacks that reduce the equity base. While impressive, this doesn\'t necessarily mean Apple is "better" - it\'s a strategic choice to return cash to shareholders.'
            }
        },
        {
            id: 'L2Q2',
            question: 'Which company improved their gross profit percentage the MOST from 2023 to 2024?',
            options: ['Alphabet (+1.6pp)', 'Meta (+0.9pp)', 'Apple (+2.1pp)'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple improved the most, increasing gross margin by 2.1 percentage points.',
                data: 'Gross Margin Change (2023‚Üí2024):\n‚Ä¢ Apple: 44.1% ‚Üí 46.2% (+2.1pp)\n‚Ä¢ Alphabet: 56.6% ‚Üí 58.2% (+1.6pp)\n‚Ä¢ Meta: 80.8% ‚Üí 81.7% (+0.9pp)',
                location: 'Select each company ‚Üí Financial Ratios ‚Üí Compare 2023 vs 2024 ‚Üí Gross Profit Percentage',
                insight: 'Apple\'s 2.1pp improvement suggests better pricing power or manufacturing efficiency. Even though Meta has the highest absolute margin (81.7%), Apple showed the biggest improvement.'
            }
        },
        {
            id: 'L2Q3',
            question: 'Which two companies have P/E ratios within 15 points of each other?',
            options: ['Alphabet & Meta', 'Alphabet & Apple', 'Meta & Apple'],
            correct: 0, // Alphabet & Meta
            explanation: {
                answer: 'Alphabet (39.26x) and Meta (26.86x) are within 12.4 points of each other.',
                data: 'P/E Ratios 2024:\n‚Ä¢ Apple: 47.04x\n‚Ä¢ Alphabet: 39.26x (diff: 7.78 from Apple)\n‚Ä¢ Meta: 26.86x (diff: 12.4 from Alphabet)\n\nClosest pair: Alphabet & Meta',
                location: 'Financial Ratios (2024) ‚Üí "Stock as Investment" ‚Üí PE Ratio ‚Üí Compare all three',
                insight: 'Meta\'s lower P/E (26.86x) despite fastest growth (22%) suggests the market may be undervaluing Meta compared to its peers.'
            }
        },
        {
            id: 'L2Q4',
            question: 'Calculate: How much MORE revenue does Apple have than Meta in 2024?',
            type: 'calculation',
            options: ['$226.5 billion', '$41.0 billion', '$186.5 billion'],
            correct: 0, // $226.5B
            explanation: {
                answer: 'Apple has $226.5 billion more revenue than Meta.',
                data: 'Calculation:\nApple Revenue: $391.0B\nMeta Revenue: $164.5B\nDifference: $391.0B - $164.5B = $226.5B',
                location: 'Trend Analysis ‚Üí Revenue row ‚Üí 2024 column for both companies',
                insight: 'Despite Apple having 2.4x Meta\'s revenue, Meta is more profitable per dollar of sales (29% margin vs Apple\'s 24%).'
            }
        },
        {
            id: 'L2Q5',
            question: 'Which company has the strongest overall liquidity position in 2024?',
            options: ['Alphabet', 'Meta', 'Apple'],
            correct: 1, // Meta
            explanation: {
                answer: 'Meta has the strongest liquidity with a current ratio of 2.98.',
                data: 'Liquidity Metrics 2024:\n‚Ä¢ Meta: Current Ratio 2.98, Working Capital $66.4B\n‚Ä¢ Alphabet: Current Ratio 1.84, Working Capital $74.6B\n‚Ä¢ Apple: Current Ratio 0.87, Working Capital -$23.4B',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Pay Current Liabilities" ‚Üí Compare all ratios',
                insight: 'While Apple has negative working capital, Meta\'s 2.98 current ratio means they have almost $3 in current assets for every $1 of current liabilities - the safest position for meeting short-term obligations.'
            }
        },
        {
            id: 'L2Q6',
            question: 'Which company collects receivables the FASTEST (fewest days)?',
            options: ['Alphabet (59.6 days)', 'Meta (Not applicable)', 'Apple (36.8 days)'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple collects receivables in 36.8 days on average.',
                data: 'Days\' Sales in Receivables 2024:\n‚Ä¢ Apple: 36.8 days (FASTEST)\n‚Ä¢ Alphabet: 59.6 days\n‚Ä¢ Meta: N/A (different business model)',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Sell Inventory and Collect Receivables" ‚Üí Days\' Sales in Receivables',
                insight: 'Apple\'s fast collection (37 days) reflects strong relationships with retailers and direct consumer sales. Faster collection means more cash available for operations and investments.'
            }
        },
        {
            id: 'L2Q7',
            question: 'True or False: Meta has higher asset turnover than Apple in 2024.',
            options: ['True', 'False'],
            correct: 1, // False
            explanation: {
                answer: 'False. Apple\'s asset turnover (1.09x) is higher than Meta\'s (0.71x).',
                data: 'Asset Turnover 2024:\n‚Ä¢ Apple: 1.09x\n‚Ä¢ Meta: 0.71x\n‚Ä¢ Alphabet: 0.58x',
                location: 'Financial Ratios (2024) ‚Üí "Profitability" ‚Üí Asset Turnover',
                insight: 'Asset turnover shows how efficiently companies use assets to generate sales. Apple generates $1.09 in sales for every $1 of assets, while Meta generates only $0.71. This is because Apple\'s hardware business requires more physical asset deployment but generates high revenue.'
            }
        },
        {
            id: 'L2Q8',
            question: 'Which company has the most efficient working capital management considering their business model?',
            options: ['Alphabet (positive working capital)', 'Meta (positive working capital)', 'Apple (negative working capital)'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple demonstrates the most efficient working capital management with negative working capital.',
                data: 'Working Capital 2024:\n‚Ä¢ Apple: -$23.4B (negative but efficient)\n‚Ä¢ Meta: +$66.4B (positive)\n‚Ä¢ Alphabet: +$74.6B (positive)',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Pay Current Liabilities" ‚Üí Working Capital',
                insight: 'Apple\'s negative working capital is actually a competitive advantage! They collect from customers (often prepaid via Apple Stores/online) before paying suppliers. This means suppliers are essentially financing Apple\'s operations for free.'
            }
        },
        {
            id: 'L2Q9',
            question: 'Which company has the highest Times Interest Earned ratio (best ability to cover interest)?',
            options: ['Alphabet (273.68x)', 'Meta (104.82x)', 'Apple (30.80x)'],
            correct: 0, // Alphabet
            explanation: {
                answer: 'Alphabet has Times Interest Earned of 273.68x, meaning operating income covers interest expense 274 times.',
                data: 'Times Interest Earned 2024:\n‚Ä¢ Alphabet: 273.68x (HIGHEST)\n‚Ä¢ Meta: 104.82x\n‚Ä¢ Apple: 30.80x',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Pay Long-Term Debt" ‚Üí Times Interest Earned',
                insight: 'All three companies can easily cover interest (anything above 2.5x is considered safe), but Alphabet\'s 274x coverage shows they have minimal debt relative to earnings. Apple\'s lower ratio (31x) reflects their strategic use of debt.'
            }
        },
        {
            id: 'L2Q10',
            question: 'How many companies have ROA (Return on Assets) above 20% in 2024?',
            options: ['One company', 'Two companies', 'All three companies'],
            correct: 2, // All three
            explanation: {
                answer: 'All three companies have ROA above 20% in 2024.',
                data: 'ROA 2024:\n‚Ä¢ Apple: 27.2% ‚úì\n‚Ä¢ Meta: 24.9% ‚úì\n‚Ä¢ Alphabet: 23.5% ‚úì\n\nAll above 20%!',
                location: 'Financial Ratios (2024) ‚Üí "Profitability" ‚Üí Return on Assets for each company',
                insight: 'ROA above 20% is exceptional - it means these companies generate $0.20+ profit for every $1 of assets. This demonstrates the power of tech business models with strong network effects and low marginal costs.'
            }
        },
        {
            id: 'L2Q11',
            question: 'Calculate the average P/E ratio across all three companies in 2024.',
            type: 'calculation',
            options: ['35.5x', '37.7x', '42.1x'],
            correct: 1, // 37.7x
            explanation: {
                answer: 'The average P/E ratio is 37.72x.',
                data: 'Calculation:\nApple: 47.04x\nAlphabet: 39.26x\nMeta: 26.86x\n\nSum: 113.16x\nAverage: 113.16 √∑ 3 = 37.72x',
                location: 'Financial Ratios (2024) ‚Üí "Stock as Investment" ‚Üí PE Ratio for each company',
                insight: 'Meta\'s P/E (26.86x) is well below the group average (37.72x), suggesting potential undervaluation. Apple\'s premium P/E (47.04x) reflects investor confidence in their brand and ecosystem.'
            }
        },
        {
            id: 'L2Q12',
            question: 'Which company improved their ROE the MOST from 2023 to 2024?',
            options: ['Alphabet (+5.5pp)', 'Meta (+9.1pp)', 'Apple (-14.5pp - declined)'],
            correct: 1, // Meta
            explanation: {
                answer: 'Meta improved ROE by 9.1 percentage points (28.0% ‚Üí 37.1%).',
                data: 'ROE Change 2023‚Üí2024:\n‚Ä¢ Meta: 28.0% ‚Üí 37.1% (+9.1pp) ‚úì\n‚Ä¢ Alphabet: 27.4% ‚Üí 32.9% (+5.5pp)\n‚Ä¢ Apple: 171.9% ‚Üí 157.4% (-14.5pp)',
                location: 'Compare Financial Ratios 2023 vs 2024 ‚Üí "Profitability" ‚Üí Return on Equity',
                insight: 'Meta\'s 9.1pp ROE improvement shows dramatically improved profitability efficiency. Apple\'s decline isn\'t necessarily bad - it was coming from an unsustainably high 172% driven by extreme buybacks.'
            }
        },
        {
            id: 'L2Q13',
            question: 'Which company has the best profit margin (keeps most profit per dollar of sales)?',
            options: ['Alphabet (23.1%)', 'Meta (29.0%)', 'Apple (24.0%)'],
            correct: 1, // Meta
            explanation: {
                answer: 'Meta has the highest profit margin at 29.0%.',
                data: 'Profit Margin 2024:\n‚Ä¢ Meta: 29.0% (HIGHEST)\n‚Ä¢ Apple: 24.0%\n‚Ä¢ Alphabet: 23.1%',
                location: 'Financial Ratios (2024) ‚Üí "Profitability" ‚Üí Profit Margin on Sales',
                insight: 'Meta\'s 29% profit margin means they keep $0.29 as profit for every $1 in revenue. Their digital platform business model (social media, ads) has very low incremental costs, leading to industry-leading margins.'
            }
        },
        {
            id: 'L2Q14',
            question: 'True or False: Apple\'s debt ratio is higher than both competitors in 2024.',
            options: ['True', 'False'],
            correct: 0, // True
            explanation: {
                answer: 'True. Apple\'s debt to asset ratio (84.4%) is higher than both Meta (33.3%) and Alphabet (29.6%).',
                data: 'Debt to Asset Ratio 2024:\n‚Ä¢ Apple: 84.4% (HIGHEST) ‚úì\n‚Ä¢ Meta: 33.3%\n‚Ä¢ Alphabet: 29.6%',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Pay Long-Term Debt" ‚Üí Debt to Asset Ratio',
                insight: 'Apple\'s high debt ratio (84.4%) reflects their strategy of using cheap debt while returning equity to shareholders through buybacks. With strong cash flows, they can easily service this debt.'
            }
        },
        {
            id: 'L2Q15',
            question: 'Which company would you consider most "overvalued" based solely on P/E ratio?',
            options: ['Alphabet (39.26x - middle)', 'Meta (26.86x - lowest)', 'Apple (47.04x - highest)'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple has the highest P/E ratio (47.04x), suggesting investors are paying the most premium for earnings.',
                data: 'P/E Ratios 2024:\n‚Ä¢ Apple: 47.04x (HIGHEST premium)\n‚Ä¢ Alphabet: 39.26x (middle)\n‚Ä¢ Meta: 26.86x (lowest premium)',
                location: 'Financial Ratios (2024) ‚Üí "Stock as Investment" ‚Üí PE Ratio',
                insight: 'Higher P/E can mean "overvalued" OR high growth expectations. Apple\'s 47x P/E reflects investor confidence in their brand loyalty, ecosystem lock-in, and services growth. Whether it\'s "overvalued" depends on future growth - not just current P/E!'
            }
        }
    ],
    
    level3: [
        {
            id: 'L3Q1',
            question: 'Why can Apple maintain negative working capital and still be financially healthy? Select the BEST explanation.',
            options: [
                'Apple has very high revenue that compensates',
                'Apple collects from customers before paying suppliers',
                'Apple has low expenses compared to competitors',
                'Apple\'s brand allows them to ignore financial rules'
            ],
            correct: 1,
            explanation: {
                answer: 'Apple collects from customers before paying suppliers - this is the key to their efficient working capital management.',
                data: 'Apple\'s Model:\n‚Ä¢ Fast inventory turnover: 27.21x (13 days)\n‚Ä¢ Quick receivable collection: 36.8 days\n‚Ä¢ Longer payment terms with suppliers: 60+ days\n‚Ä¢ Result: Negative working capital of -$23.4B',
                location: 'Analyze: Financial Ratios ‚Üí Working Capital, Inventory Turnover, Days\' Sales in Receivables',
                insight: 'Apple\'s business model creates a "cash conversion cycle" advantage. They sell products quickly (13 days), collect cash from customers fast (37 days), but pay suppliers slowly (60+ days). This means suppliers essentially provide free financing!'
            }
        },
        {
            id: 'L3Q2',
            question: 'Based on ALL financial ratios, which company has the strongest balance sheet (lowest financial risk)?',
            options: ['Alphabet', 'Meta', 'Apple'],
            correct: 0, // Alphabet
            explanation: {
                answer: 'Alphabet has the strongest balance sheet with lowest debt ratios and highest interest coverage.',
                data: 'Balance Sheet Strength Indicators:\n‚Ä¢ Debt to Equity: Alphabet 0.42x (lowest) ‚úì\n‚Ä¢ Debt to Asset: Alphabet 29.6% (lowest) ‚úì\n‚Ä¢ Times Interest Earned: Alphabet 274x (highest) ‚úì\n‚Ä¢ Current Ratio: Meta 2.98 (highest liquidity)',
                location: 'Compare all companies ‚Üí Financial Ratios ‚Üí "Ability to Pay Long-Term Debt" + Liquidity ratios',
                insight: 'Alphabet combines low debt (0.42x debt/equity) with strong profitability. While Meta has better liquidity (2.98 current ratio), Alphabet\'s minimal leverage means lowest financial risk during economic downturns.'
            }
        },
        {
            id: 'L3Q3',
            question: 'If you had to invest in ONE company for dividend income, which offers the best combination of yield AND safety?',
            options: ['Alphabet (0.17% yield, strong balance sheet)', 'Meta (0.31% yield, high growth)', 'Apple (0.35% yield, established program)'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple offers the best combination with 0.35% yield, established dividend history, and strong cash flows.',
                data: 'Dividend Analysis 2024:\n‚Ä¢ Apple: $0.99/share, 0.35% yield, 16.3% payout\n‚Ä¢ Meta: $2.00/share, 0.31% yield, 8.4% payout (NEW in 2024)\n‚Ä¢ Alphabet: $0.60/share, 0.17% yield (NEW in 2024)',
                location: 'Financial Ratios (2024) ‚Üí "Stock as Investment" ‚Üí Dividend Yield & Dividend Payout',
                insight: 'Apple wins for dividend investing because: (1) Highest yield 0.35%, (2) Sustainable payout ratio 16%, (3) Massive operating cash flow $118B supports growth. Meta & Alphabet just started dividends in 2024 - less proven.'
            }
        },
        {
            id: 'L3Q4',
            question: 'Which company uses financial leverage MOST effectively? (Compare ROE vs ROA to measure leverage benefit)',
            options: ['Alphabet (ROE 32.9%, ROA 23.5%)', 'Meta (ROE 37.1%, ROA 24.9%)', 'Apple (ROE 157.4%, ROA 27.2%)'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple uses leverage most effectively with ROE of 157.4% versus ROA of 27.2% - a 130pp difference.',
                data: 'Leverage Analysis (ROE - ROA):\n‚Ä¢ Apple: 157.4% - 27.2% = 130.2pp benefit ‚úì\n‚Ä¢ Meta: 37.1% - 24.9% = 12.2pp benefit\n‚Ä¢ Alphabet: 32.9% - 23.5% = 9.4pp benefit',
                location: 'Financial Ratios (2024) ‚Üí "Profitability" ‚Üí Compare ROE vs ROA for each company',
                insight: 'The gap between ROE and ROA shows leverage effectiveness. Apple\'s massive 130pp gap comes from (1) stock buybacks reducing equity base, (2) strategic debt usage. This amplifies returns to remaining shareholders dramatically!'
            }
        },
        {
            id: 'L3Q5',
            question: 'Meta has the lowest P/E ratio (26.86x) despite the highest growth rate (22%). What\'s the MOST likely market concern?',
            options: [
                'Meta has too much debt',
                'Meta\'s margins are too low',
                'Uncertainty about Meta\'s metaverse investments and future profitability',
                'Meta has poor management'
            ],
            correct: 2,
            explanation: {
                answer: 'Market uncertainty about metaverse investments and future profitability likely explains Meta\'s discount valuation.',
                data: 'The Paradox:\n‚Ä¢ Meta growth: 22% (FASTEST)\n‚Ä¢ Meta P/E: 26.86x (LOWEST)\n‚Ä¢ Meta margins: 81.7% gross, 29% net (BEST)\n‚Ä¢ Meta debt: 0.50x debt/equity (HEALTHY)\n\nYet valued lowest - why?',
                location: 'Compare: Financial Ratios 2024 ‚Üí P/E Ratio vs Growth Rate (Horizontal Analysis 2023-2024)',
                insight: 'Meta\'s "discount" P/E reflects investor concern about $10B+ annual metaverse spending with uncertain returns. Despite strong core business (ads), market worries about capital allocation. This creates potential opportunity if metaverse succeeds!'
            }
        },
        {
            id: 'L3Q6',
            question: 'Which company faces the GREATEST financial risk based on debt coverage and leverage?',
            options: ['Alphabet', 'Meta', 'Apple'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple faces the highest financial risk with 84.4% debt/assets and 5.41x debt/equity ratios.',
                data: 'Risk Indicators 2024:\n‚Ä¢ Apple: Debt/Asset 84.4%, Debt/Equity 5.41x ‚ö†Ô∏è\n‚Ä¢ Meta: Debt/Asset 33.3%, Debt/Equity 0.50x ‚úì\n‚Ä¢ Alphabet: Debt/Asset 29.6%, Debt/Equity 0.42x ‚úì\n\nBUT Apple\'s interest coverage: 31x (still safe)',
                location: 'Financial Ratios (2024) ‚Üí "Ability to Pay Long-Term Debt" ‚Üí All three ratios',
                insight: 'Apple has HIGHEST leverage but LOWEST actual risk! Their $118B operating cash flow (vs $4B interest) means 31x coverage. High debt is strategic choice, not distress. Risk in downturn when revenue falls.'
            }
        },
        {
            id: 'L3Q7',
            question: 'Based on 3-year trend analysis, which company has the MOST consistent growth pattern?',
            options: ['Alphabet (steady growth)', 'Meta (volatile - dip then recovery)', 'Apple (slow, stable growth)'],
            correct: 0, // Alphabet
            explanation: {
                answer: 'Alphabet shows the most consistent growth with steady increases across all three years.',
                data: 'Revenue Trend 2022-2024:\n‚Ä¢ Alphabet: $282.8B ‚Üí $307.4B ‚Üí $350.0B (steady +9-14%)\n‚Ä¢ Meta: $116.6B ‚Üí $134.9B ‚Üí $164.5B (recovery +16-22%)\n‚Ä¢ Apple: $394.3B ‚Üí $383.3B ‚Üí $391.0B (flat ¬±2%)',
                location: 'Trend Analysis ‚Üí Revenue row ‚Üí Compare 2022, 2023, 2024 patterns',
                insight: 'Alphabet\'s consistency (9%, 14% growth) shows stable business model. Meta\'s volatility (16%, 22%) shows recovery from 2022 slowdown. Apple\'s maturity (¬±2%) typical for $390B+ company - limited growth runway.'
            }
        },
        {
            id: 'L3Q8',
            question: 'Why is Apple\'s ROE (157%) so much higher than Alphabet (33%) and Meta (37%)? Select the PRIMARY reason.',
            options: [
                'Apple has much higher profit margins',
                'Apple uses massive stock buybacks to reduce equity base',
                'Apple has better management',
                'Apple has more efficient operations'
            ],
            correct: 1,
            explanation: {
                answer: 'Apple\'s massive stock buybacks reduce the equity base (denominator), dramatically inflating ROE.',
                data: 'The Math:\nROE = Net Income √∑ Equity\n\n‚Ä¢ Apple: $93.7B √∑ $56.9B equity = 157%\n‚Ä¢ Alphabet: $100.1B √∑ $283.4B equity = 33%\n‚Ä¢ Meta: $62.4B √∑ $153.2B equity = 37%\n\nApple has LESS equity despite similar income!',
                location: 'Financial Ratios (2024) ‚Üí ROE + Balance Sheet data',
                insight: 'Apple\'s equity of only $56.9B (vs Alphabet $283B) is intentional - they buy back ~$90B stock annually. This reduces shares/equity, boosting ROE. High ROE from buybacks ‚â† necessarily "better" than high ROE from operations!'
            }
        },
        {
            id: 'L3Q9',
            question: 'Considering ALL factors (growth, value, risk, dividends), which company represents the BEST overall investment? Defend your choice.',
            options: ['Alphabet (balanced profile)', 'Meta (growth at discount)', 'Apple (quality premium)'],
            correct: 1, // This is subjective but Meta offers best risk/reward
            explanation: {
                answer: 'Meta offers the best risk/reward with 22% growth, 29% margins, and lowest P/E (26.86x) - market discount creates opportunity.',
                data: 'Comparative Analysis:\n‚Ä¢ Meta: 22% growth, 26.86x P/E = 0.86 PEG ratio\n‚Ä¢ Apple: 2% growth, 47.04x P/E = 23.5 PEG ratio\n‚Ä¢ Alphabet: 14% growth, 39.26x P/E = 2.8 PEG ratio\n\nLower PEG = better value for growth',
                location: 'Combine: Growth Rate (Horizontal Analysis) + P/E Ratio + Margins',
                insight: 'Note: This is analytical reasoning, not investment advice! Meta\'s combination of fastest growth (22%), best margins (29%), lowest valuation (26.86x P/E) suggests market discount. BUT each has merits: Apple = quality/dividends, Alphabet = balance/stability.'
            }
        },
        {
            id: 'L3Q10',
            question: 'Strategic Analysis: Based on working capital management, which company would be MOST vulnerable during an economic recession?',
            options: ['Alphabet (positive working capital)', 'Meta (positive working capital)', 'Apple (negative working capital)'],
            correct: 2, // Apple
            explanation: {
                answer: 'Apple would be most vulnerable because negative working capital requires continuous strong sales and fast inventory turnover.',
                data: 'Recession Scenario Analysis:\n‚Ä¢ Apple: -$23.4B working capital, 27x turnover\n  ‚Üí If sales slow, can\'t pay suppliers on time\n‚Ä¢ Meta: +$66.4B working capital\n  ‚Üí Cash cushion of $66B\n‚Ä¢ Alphabet: +$74.6B working capital\n  ‚Üí Cash cushion of $75B',
                location: 'Financial Ratios (2024) ‚Üí Working Capital + Inventory Turnover + Business model analysis',
                insight: 'Apple\'s efficiency (negative working capital) becomes weakness in recession! If iPhone sales slow: (1) Inventory builds up (13‚Üí30+ days), (2) Receivables slow (37‚Üí60+ days), (3) But suppliers still want payment (60 days). Cash crunch risk! Meta/Alphabet\'s positive working capital = buffer.'
            }
        }
    ]
};


// GAME STATE MANAGEMENT - Simplified for split-screen
let gameState = {
    currentLevel: null,  // null = dashboard, 1/2/3 = playing level
    currentQuestion: 0,
    selectedAnswer: null,
    scores: {
        level1: { attempts: 0, correct: 0, total: 15, passed: false, bestScore: 0 },
        level2: { attempts: 0, correct: 0, total: 15, passed: false, bestScore: 0 },
        level3: { attempts: 0, correct: 0, total: 10, passed: false, bestScore: 0 }
    },
    showingFeedback: false,
    lastAnswer: null,
    answeredQuestions: []  // Track answered questions for review: [{questionIndex, userAnswer, isCorrect}]
};

// Load game state from localStorage
function loadGameState() {
    const saved = localStorage.getItem('financialDetectiveState');
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            gameState.scores = parsed.scores || gameState.scores;
        } catch (e) {
            console.log('Could not load saved game state');
        }
    }
    
    // Show game dashboard on load
    renderGameDashboard();
}

// Save game state to localStorage
function saveGameState() {
    localStorage.setItem('financialDetectiveState', JSON.stringify({
        scores: gameState.scores
    }));
}

// TOGGLE GAME PANEL (Minimize/Maximize)
function toggleGamePanel() {
    const panel = document.getElementById('gamePanel');
    const btn = document.getElementById('minimizeBtn');
    panel.classList.toggle('minimized');
    btn.textContent = panel.classList.contains('minimized') ? '+' : '‚àí';
}

// RENDER GAME DASHBOARD
function renderGameDashboard() {
    const content = document.getElementById('gameContent');
    const scores = gameState.scores;
    
    // Calculate overall progress
    const totalQuestions = 40;
    const answeredCorrectly = scores.level1.bestScore + scores.level2.bestScore + scores.level3.bestScore;
    const overallProgress = Math.round((answeredCorrectly / totalQuestions) * 100);
    
    content.innerHTML = `
        <div class="start-game-prompt">
            <h3>üéÆ Choose Your Level</h3>
            <p>Search the data on the left to find answers!</p>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px;">Overall Progress</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${overallProgress}%">
                    ${overallProgress}%
                </div>
            </div>
            <div style="margin-top: 8px; color: var(--text-light); font-size: 0.85rem;">
                ${answeredCorrectly} / ${totalQuestions} mastered
            </div>
        </div>
        
        ${renderLevelCard(1, scores.level1, true)}
        ${renderLevelCard(2, scores.level2, scores.level1.passed)}
        ${renderLevelCard(3, scores.level3, scores.level2.passed)}
    `;
    
    // Add event listeners
    attachLevelButtons();
}

// RENDER LEVEL CARD
function renderLevelCard(levelNum, levelScore, isUnlocked) {
    const levelNames = {
        1: 'DETECTIVE INTERN',
        2: 'FINANCIAL ANALYST',
        3: 'MASTER DETECTIVE'
    };
    
    const requiredScores = { 1: 12, 2: 11, 3: 7 }; // 80%, 75%, 70%
    const percentRequired = { 1: 80, 2: 75, 3: 70 };
    
    const isPassed = levelScore.passed;
    const progressPercent = levelScore.total > 0 ? Math.round((levelScore.bestScore / levelScore.total) * 100) : 0;
    
    let statusClass, statusText, statusBadge;
    if (isPassed) {
        statusClass = 'completed';
        statusText = `‚úÖ PASSED (${levelScore.bestScore}/${levelScore.total} = ${progressPercent}%)`;
        statusBadge = '<span class="level-status completed">Completed</span>';
    } else if (isUnlocked) {
        statusClass = 'unlocked';
        statusText = levelScore.attempts > 0 ? 
            `Progress: ${levelScore.bestScore}/${levelScore.total} (${progressPercent}%) - Need ${percentRequired[levelNum]}% to pass` :
            `Ready to start! Need ${requiredScores[levelNum]}/${levelScore.total} correct (${percentRequired[levelNum]}%) to pass`;
        statusBadge = '<span class="level-status unlocked">Unlocked</span>';
    } else {
        statusClass = 'locked';
        statusText = `Complete Level ${levelNum - 1} to unlock`;
        statusBadge = '<span class="level-status locked">üîí Locked</span>';
    }
    
    return `
        <div class="level-card ${statusClass}">
            <div class="level-header">
                <div class="level-title">LEVEL ${levelNum}: ${levelNames[levelNum]}</div>
                ${statusBadge}
            </div>
            <div class="level-info">
                ${statusText}
            </div>
            ${levelScore.attempts > 0 && !isPassed ? `
                <div class="level-progress">
                    <div style="font-size: 0.85rem; margin-bottom: 5px; color: var(--text-muted);">
                        Best attempt: ${levelScore.bestScore}/${levelScore.total} (${progressPercent}%)
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%">
                            ${progressPercent}%
                        </div>
                    </div>
                </div>
            ` : ''}
            <div class="level-buttons">
                ${isPassed ? `
                    <button class="level-button secondary" onclick="reviewLevel(${levelNum})">
                        üìñ Review Level ${levelNum}
                    </button>
                    <button class="level-button secondary" onclick="retryLevel(${levelNum})">
                        üîÑ Retry for Better Score
                    </button>
                ` : isUnlocked ? `
                    <button class="level-button primary" onclick="startLevel(${levelNum})">
                        ${levelScore.attempts > 0 ? 'üîÑ Try Again' : '‚ñ∂Ô∏è Start Level ' + levelNum}
                    </button>
                    ${levelScore.attempts > 0 ? `
                        <button class="level-button secondary" onclick="reviewLevel(${levelNum})">
                            üìñ Review Questions
                        </button>
                    ` : ''}
                ` : `
                    <button class="level-button secondary" disabled>
                        üîí Complete Level ${levelNum - 1} First
                    </button>
                `}
            </div>
        </div>
    `;
}

// ATTACH BUTTON LISTENERS
function attachLevelButtons() {
    // Buttons use onclick attributes for simplicity
}

// START LEVEL
function startLevel(levelNum) {
    gameState.currentLevel = levelNum;
    gameState.currentQuestion = 0;
    gameState.selectedAnswer = null;
    gameState.showingFeedback = false;
    gameState.answeredQuestions = [];  // Reset answered questions for review
    
    // Reset current attempt score
    const levelKey = 'level' + levelNum;
    gameState.scores[levelKey].correct = 0;
    
    renderQuestion();
}

// RETRY LEVEL (for better score)
function retryLevel(levelNum) {
    startLevel(levelNum);
}

// REVIEW LEVEL (show all questions without scoring)
function reviewLevel(levelNum) {
    alert('Review mode coming soon! For now, use "Try Again" to see questions again.');
}

// RETURN TO DASHBOARD (navigation from questions/results)
function returnToDashboard() {
    renderGameDashboard();
}

// RENDER QUESTION
function renderQuestion() {
    const levelKey = 'level' + gameState.currentLevel;
    const questions = GAME_QUESTIONS[levelKey];
    const questionIndex = gameState.currentQuestion;
    const question = questions[questionIndex];
    
    const questionNum = questionIndex + 1;
    const totalQuestions = questions.length;
    const currentScore = gameState.scores[levelKey].correct;
    
    const content = document.getElementById('gameContent');
    content.innerHTML = `
        <div class="question-container">
            <div class="question-header">
                <div class="question-number">
                    üìù Question ${questionNum}/${totalQuestions}
                </div>
                <div class="question-score">
                    ‚úì ${currentScore}/${questionNum - 1}
                </div>
            </div>
            
            <div class="question-text">
                ${question.question}
            </div>
            
            <div class="answer-options" id="answerOptions">
                ${question.options.map((option, index) => `
                    <div class="answer-option" data-index="${index}" onclick="selectAnswer(${index})">
                        ${String.fromCharCode(65 + index)}) ${option}
                    </div>
                `).join('')}
            </div>
            
            <div class="question-actions">
                <button class="action-button submit" id="submitBtn" onclick="submitAnswer()" disabled>
                    Submit Answer
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 12px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 6px;">
                <div style="color: var(--accent); font-size: 0.85rem; font-weight: 500;">
                    üí° Use the data panel on the left to find your answer!
                </div>
            </div>
        </div>
    `;
    
    gameState.selectedAnswer = null;
}

// SELECT ANSWER
function selectAnswer(index) {
    gameState.selectedAnswer = index;
    
    // Update UI
    const options = document.querySelectorAll('.answer-option');
    options.forEach((opt, i) => {
        if (i === index) {
            opt.classList.add('selected');
        } else {
            opt.classList.remove('selected');
        }
    });
    
    // Enable submit button
    document.getElementById('submitBtn').disabled = false;
}

// SUBMIT ANSWER
function submitAnswer() {
    if (gameState.selectedAnswer === null) return;
    
    const levelKey = 'level' + gameState.currentLevel;
    const questions = GAME_QUESTIONS[levelKey];
    const question = questions[gameState.currentQuestion];
    
    const isCorrect = gameState.selectedAnswer === question.correct;
    
    if (isCorrect) {
        gameState.scores[levelKey].correct++;
    }
    
    gameState.lastAnswer = {
        question: question,
        selectedIndex: gameState.selectedAnswer,
        isCorrect: isCorrect
    };
    
    // Track this answered question for review
    gameState.answeredQuestions.push({
        questionIndex: gameState.currentQuestion,
        userAnswer: gameState.selectedAnswer,
        isCorrect: isCorrect
    });
    
    renderFeedback();
}

// GO TO PREVIOUS QUESTION (for review)
function goToPreviousQuestion() {
    // Can't go back if we're on the first question
    if (gameState.currentQuestion === 0) return;
    
    // Move back one question
    gameState.currentQuestion--;
    
    // Get the answered question data
    const answeredData = gameState.answeredQuestions[gameState.currentQuestion];
    const levelKey = 'level' + gameState.currentLevel;
    const questions = GAME_QUESTIONS[levelKey];
    const question = questions[gameState.currentQuestion];
    
    // Reconstruct the lastAnswer for this question
    gameState.lastAnswer = {
        question: question,
        selectedIndex: answeredData.userAnswer,
        isCorrect: answeredData.isCorrect
    };
    
    // Show feedback for this previous question
    renderFeedback();
}

// RENDER FEEDBACK
function renderFeedback() {
    const { question, selectedIndex, isCorrect } = gameState.lastAnswer;
    const selectedOption = question.options[selectedIndex];
    const correctOption = question.options[question.correct];
    
    const levelKey = 'level' + gameState.currentLevel;
    const currentScore = gameState.scores[levelKey].correct;
    const questionNum = gameState.currentQuestion + 1;
    const totalQuestions = GAME_QUESTIONS[levelKey].length;
    
    const content = document.getElementById('gameContent');
    content.innerHTML = `
        <div class="game-container">
            <div class="feedback-container ${isCorrect ? 'correct' : 'incorrect'}">
                <div class="feedback-header ${isCorrect ? 'correct' : 'incorrect'}">
                    ${isCorrect ? '‚úÖ CORRECT!' : '‚ùå NOT QUITE...'}
                    ${isCorrect ? '+10 points' : 'No points'}
                </div>
                
                ${!isCorrect ? `
                    <div style="margin: 15px 0; padding: 10px; background: var(--bg-dark); border-radius: 8px;">
                        <div style="color: var(--text-muted); font-size: 0.9rem;">You selected:</div>
                        <div style="color: var(--text-light); font-weight: 600; margin-top: 5px;">${selectedOption}</div>
                        <div style="color: #2ecc71; font-size: 0.9rem; margin-top: 10px;">Correct answer:</div>
                        <div style="color: #2ecc71; font-weight: 600; margin-top: 5px;">${correctOption}</div>
                    </div>
                ` : `
                    <div style="margin: 15px 0; font-weight: 600; color: var(--text-light);">
                        ${question.explanation.answer}
                    </div>
                `}
                
                <div class="feedback-section">
                    <h4>üìä THE DATA:</h4>
                    <div class="feedback-data">${question.explanation.data.replace(/\n/g, '<br>')}</div>
                </div>
                
                <div class="feedback-section">
                    <h4>üí° WHERE TO FIND IT:</h4>
                    <div style="line-height: 1.6;">${question.explanation.location}</div>
                </div>
                
                <div class="feedback-section">
                    <h4>üéØ ${isCorrect ? 'WHY THIS MATTERS:' : 'LEARNING TIP:'}</h4>
                    <div style="line-height: 1.6;">${question.explanation.insight}</div>
                </div>
                
                <div style="text-align: center; margin: 20px 0; padding: 15px; background: var(--bg-dark); border-radius: 8px;">
                    <div style="font-size: 1.1rem; font-weight: 600; color: var(--accent);">
                        Current Score: ${currentScore}/${questionNum}
                    </div>
                </div>
                
                <div class="feedback-actions">
                    ${gameState.currentQuestion > 0 ? `
                        <button class="action-button secondary" onclick="goToPreviousQuestion()">
                            ‚Üê Previous
                        </button>
                    ` : ''}
                    <button class="action-button submit" onclick="nextQuestion()">
                        ${questionNum < totalQuestions ? 'Next Question ‚Üí' : 'See Results ‚Üí'}
                    </button>
                </div>
            </div>
        </div>
    `;
}

// NEXT QUESTION
function nextQuestion() {
    const levelKey = 'level' + gameState.currentLevel;
    const totalQuestions = GAME_QUESTIONS[levelKey].length;
    
    gameState.currentQuestion++;
    
    if (gameState.currentQuestion >= totalQuestions) {
        // Level complete - show results
        showLevelResults();
    } else {
        renderQuestion();
    }
}

// SHOW LEVEL RESULTS
function showLevelResults() {
    const levelKey = 'level' + gameState.currentLevel;
    const levelScore = gameState.scores[levelKey];
    const totalQuestions = GAME_QUESTIONS[levelKey].length;
    const currentScore = levelScore.correct;
    const percentScore = Math.round((currentScore / totalQuestions) * 100);
    
    // Update attempts
    levelScore.attempts++;
    
    // Update best score
    if (currentScore > levelScore.bestScore) {
        levelScore.bestScore = currentScore;
    }
    
    // Check if passed
    const passingScores = { level1: 12, level2: 11, level3: 7 };
    const passingPercents = { level1: 80, level2: 75, level3: 70 };
    const required = passingScores[levelKey];
    const requiredPercent = passingPercents[levelKey];
    const passed = currentScore >= required;
    
    if (passed && !levelScore.passed) {
        levelScore.passed = true;
    }
    
    // Save state
    saveGameState();
    
    // Render results
    const content = document.getElementById('gameContent');
    content.innerHTML = `
        <div class="game-container">
            <div class="game-dashboard">
                <div class="game-title">
                    ${passed ? 'üéâ LEVEL COMPLETE!' : 'üìä LEVEL RESULTS'}
                </div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">
                        ${passed ? '‚úÖ' : '‚ùå'}
                    </div>
                    <div style="font-size: 2rem; font-weight: bold; color: ${passed ? '#2ecc71' : '#e74c3c'}; margin-bottom: 10px;">
                        ${currentScore} / ${totalQuestions}
                    </div>
                    <div style="font-size: 1.5rem; color: var(--text-light); margin-bottom: 20px;">
                        ${percentScore}%
                    </div>
                    
                    ${passed ? `
                        <div style="background: rgba(46, 204, 113, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #2ecc71; margin: 20px 0;">
                            <div style="font-size: 1.2rem; font-weight: 600; color: #2ecc71; margin-bottom: 10px;">
                                ‚ú® PASSED! ‚ú®
                            </div>
                            <div style="color: var(--text-light);">
                                You scored ${percentScore}% (required: ${requiredPercent}%)
                            </div>
                            ${gameState.currentLevel < 3 ? `
                                <div style="color: var(--accent); margin-top: 10px; font-weight: 600;">
                                    üéì Level ${gameState.currentLevel + 1} is now unlocked!
                                </div>
                            ` : `
                                <div style="color: var(--accent); margin-top: 10px; font-weight: 600;">
                                    üèÜ Congratulations, Master Detective! You've completed all levels!
                                </div>
                            `}
                        </div>
                    ` : `
                        <div style="background: rgba(231, 76, 60, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #e74c3c; margin: 20px 0;">
                            <div style="font-size: 1.2rem; font-weight: 600; color: #e74c3c; margin-bottom: 10px;">
                                Keep Trying!
                            </div>
                            <div style="color: var(--text-light);">
                                You scored ${percentScore}% (need: ${requiredPercent}%)
                            </div>
                            <div style="color: var(--text-muted); margin-top: 10px;">
                                Needed: ${required}/${totalQuestions} correct
                            </div>
                            <div style="color: var(--text-muted);">
                                You got: ${currentScore}/${totalQuestions} correct
                            </div>
                            <div style="color: var(--accent); margin-top: 10px; font-weight: 600;">
                                üí° Review the explanations and try again!
                            </div>
                        </div>
                    `}
                    
                    <div style="margin-top: 20px; padding: 15px; background: var(--bg-dark); border-radius: 8px;">
                        <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 5px;">Attempt #${levelScore.attempts}</div>
                        <div style="color: var(--text-light);">Best Score: ${levelScore.bestScore}/${totalQuestions}</div>
                    </div>
                </div>
                
                <div class="level-buttons">
                    ${passed && gameState.currentLevel < 3 ? `
                        <button class="level-button primary" onclick="startLevel(${gameState.currentLevel + 1})">
                            ‚ñ∂Ô∏è Start Level ${gameState.currentLevel + 1}
                        </button>
                    ` : ''}
                    ${!passed ? `
                        <button class="level-button primary" onclick="startLevel(${gameState.currentLevel})">
                            üîÑ Try Again
                        </button>
                    ` : ''}
                    <button class="level-button secondary" onclick="returnToDashboard()">
                        ‚Üê Back to Dashboard
                    </button>
                </div>
            </div>
        </div>
    `;
}

// QUICK RATIO LOOKUP FUNCTIONS

// Ratio mapping to DATA structure
const RATIO_MAP = {
    // Year is passed as parameter
    workingCapital: (company, year) => {
        const ratios = DATA.ratios[year].liquidity;
        const ratio = ratios.find(r => r.name === 'Working Capital');
        return ratio ? ratio[company].value : 'N/A';
    },
    currentRatio: (company, year) => {
        const ratios = DATA.ratios[year].liquidity;
        const ratio = ratios.find(r => r.name === 'Current Ratio');
        return ratio ? ratio[company].value : 'N/A';
    },
    cashRatio: (company, year) => {
        const ratios = DATA.ratios[year].liquidity;
        const ratio = ratios.find(r => r.name === 'Cash Ratio');
        return ratio ? ratio[company].value : 'N/A';
    },
    acidTest: (company, year) => {
        const ratios = DATA.ratios[year].liquidity;
        const ratio = ratios.find(r => r.name === 'Acid-Test Ratio');
        return ratio ? ratio[company].value : 'N/A';
    },
    inventoryTurnover: (company, year) => {
        const ratios = DATA.ratios[year].activity;
        const ratio = ratios.find(r => r.name === 'Inventory Turnover');
        return ratio ? ratio[company].value : 'N/A';
    },
    daysInventory: (company, year) => {
        const ratios = DATA.ratios[year].activity;
        const ratio = ratios.find(r => r.name === "Days' Sales in Inventory");
        return ratio ? ratio[company].value : 'N/A';
    },
    grossProfitPct: (company, year) => {
        const ratios = DATA.ratios[year].activity;
        const ratio = ratios.find(r => r.name === 'Gross Profit Percentage');
        return ratio ? ratio[company].display : 'N/A';
    },
    arTurnover: (company, year) => {
        const ratios = DATA.ratios[year].activity;
        const ratio = ratios.find(r => r.name === 'Accounts Receivable Turnover');
        return ratio ? ratio[company].value : 'N/A';
    },
    daysReceivables: (company, year) => {
        const ratios = DATA.ratios[year].activity;
        const ratio = ratios.find(r => r.name === "Days' Sales in Receivables");
        return ratio ? ratio[company].value : 'N/A';
    },
    debtToAsset: (company, year) => {
        const ratios = DATA.ratios[year].solvency;
        const ratio = ratios.find(r => r.name === 'Debt to Asset Ratio');
        return ratio ? ratio[company].value : 'N/A';
    },
    debtToEquity: (company, year) => {
        const ratios = DATA.ratios[year].solvency;
        const ratio = ratios.find(r => r.name === 'Debt to Equity Ratio');
        return ratio ? ratio[company].value : 'N/A';
    },
    timesInterest: (company, year) => {
        const ratios = DATA.ratios[year].solvency;
        const ratio = ratios.find(r => r.name === 'Times Interest Earned');
        return ratio ? ratio[company].value : 'N/A';
    },
    profitMargin: (company, year) => {
        const ratios = DATA.ratios[year].profitability;
        const ratio = ratios.find(r => r.name === 'Profit Margin on Sales');
        return ratio ? ratio[company].display : 'N/A';
    },
    roa: (company, year) => {
        const ratios = DATA.ratios[year].profitability;
        const ratio = ratios.find(r => r.name === 'Return on Assets');
        return ratio ? ratio[company].display : 'N/A';
    },
    assetTurnover: (company, year) => {
        const ratios = DATA.ratios[year].profitability;
        const ratio = ratios.find(r => r.name === 'Asset Turnover');
        return ratio ? ratio[company].value : 'N/A';
    },
    roe: (company, year) => {
        const ratios = DATA.ratios[year].profitability;
        const ratio = ratios.find(r => r.name === 'Return on Equity');
        return ratio ? ratio[company].display : 'N/A';
    },
    eps: (company, year) => {
        const ratios = DATA.ratios[year].profitability;
        const ratio = ratios.find(r => r.name === 'Earnings Per Share');
        return ratio ? ratio[company].value : 'N/A';
    },
    peRatio: (company, year) => {
        const ratios = DATA.ratios[year].investment;
        const ratio = ratios.find(r => r.name === 'PE Ratio');
        return ratio ? ratio[company].value : 'N/A';
    },
    dividendYield: (company, year) => {
        const ratios = DATA.ratios[year].investment;
        const ratio = ratios.find(r => r.name === 'Dividend Yield');
        return ratio ? ratio[company].display : 'N/A';
    },
    dividendPayout: (company, year) => {
        const ratios = DATA.ratios[year].investment;
        const ratio = ratios.find(r => r.name === 'Dividend Payout');
        return ratio ? ratio[company].display : 'N/A';
    }
};

const RATIO_NAMES = {
    workingCapital: 'Working Capital',
    currentRatio: 'Current Ratio',
    cashRatio: 'Cash Ratio',
    acidTest: 'Acid-Test Ratio',
    inventoryTurnover: 'Inventory Turnover',
    daysInventory: "Days' Sales in Inventory",
    grossProfitPct: 'Gross Profit Percentage',
    arTurnover: 'Accounts Receivable Turnover',
    daysReceivables: "Days' Sales in Receivables",
    debtToAsset: 'Debt to Asset Ratio',
    debtToEquity: 'Debt to Equity Ratio',
    timesInterest: 'Times Interest Earned',
    profitMargin: 'Profit Margin on Sales',
    roa: 'Return on Assets (ROA)',
    assetTurnover: 'Asset Turnover',
    roe: 'Return on Equity (ROE)',
    eps: 'Earnings Per Share (EPS)',
    peRatio: 'P/E Ratio',
    dividendYield: 'Dividend Yield',
    dividendPayout: 'Dividend Payout'
};

// FORMAT RATIO VALUE - Round to 2 decimal places
function formatRatioValue(value) {
    if (value === 'N/A' || value === null || value === undefined) {
        return 'N/A';
    }
    
    const valueStr = String(value);
    
    // Extract number and suffix
    const match = valueStr.match(/^([^0-9-]*)([-]?[0-9,.]+)([^0-9]*)$/);
    
    if (!match) {
        return valueStr; // Return as-is if can't parse
    }
    
    const prefix = match[1]; // $ or other prefix
    const numberPart = match[2].replace(/,/g, ''); // Remove commas
    const suffix = match[3]; // %, x, etc.
    
    const numValue = parseFloat(numberPart);
    
    if (isNaN(numValue)) {
        return valueStr;
    }
    
    // Round to 2 decimal places
    const rounded = Math.round(numValue * 100) / 100;
    
    // Format with commas for large numbers
    const formatted = rounded.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
    
    return prefix + formatted + suffix;
}

function renderQuickRatioComparison(ratioKey) {
    const display = document.getElementById('quickRatioDisplay');
    const year = 2024; // Always use 2024 for game questions
    
    const companies = ['alphabet', 'meta', 'apple'];
    const companyNames = {
        alphabet: 'Alphabet',
        meta: 'Meta',
        apple: 'Apple'
    };
    
    const values = companies.map(company => ({
        company: company,
        name: companyNames[company],
        value: RATIO_MAP[ratioKey](company, year),
        rawValue: RATIO_MAP[ratioKey](company, year)
    }));
    
    // Find highest value for highlighting (if numeric)
    let highestIndex = -1;
    const numericValues = values.map(v => {
        const numStr = String(v.rawValue).replace(/[^0-9.-]/g, '');
        return parseFloat(numStr);
    });
    
    if (numericValues.every(v => !isNaN(v))) {
        const maxValue = Math.max(...numericValues);
        highestIndex = numericValues.indexOf(maxValue);
    }
    
    let html = `
        <div style="margin-bottom: 10px;">
            <strong style="color: #2c3e50; font-size: 1.05rem;">${RATIO_NAMES[ratioKey]}</strong>
            <span style="color: var(--text-muted); font-size: 0.9rem; margin-left: 10px;">(2024)</span>
        </div>
    `;
    
    values.forEach((v, index) => {
        const isHighest = index === highestIndex;
        const formattedValue = formatRatioValue(v.value);
        html += `
            <div class="ratio-comparison-row ${isHighest ? 'highlight' : ''}">
                <span class="ratio-company-name">${v.name}</span>
                <span class="ratio-value">${formattedValue}${isHighest ? ' ‚Üê HIGHEST' : ''}</span>
            </div>
        `;
    });
    
    display.innerHTML = html;
}

function renderQuickCategoryComparison(category) {
    const display = document.getElementById('quickRatioDisplay');
    const year = 2024;
    
    const categoryNames = {
        liquidity: 'Liquidity Ratios',
        activity: 'Activity Ratios',
        solvency: 'Solvency Ratios',
        profitability: 'Profitability Ratios',
        investment: 'Investment Ratios'
    };
    
    const categoryRatios = {
        liquidity: ['workingCapital', 'currentRatio', 'cashRatio', 'acidTest'],
        activity: ['inventoryTurnover', 'daysInventory', 'grossProfitPct', 'arTurnover', 'daysReceivables'],
        solvency: ['debtToAsset', 'debtToEquity', 'timesInterest'],
        profitability: ['profitMargin', 'roa', 'assetTurnover', 'roe', 'eps'],
        investment: ['peRatio', 'dividendYield', 'dividendPayout']
    };
    
    const ratios = categoryRatios[category];
    const companies = ['alphabet', 'meta', 'apple'];
    const companyNames = { alphabet: 'GOOG', meta: 'META', apple: 'AAPL' };
    
    let html = `
        <div style="margin-bottom: 10px;">
            <strong style="color: #2c3e50; font-size: 1.05rem;">${categoryNames[category]}</strong>
            <span style="color: var(--text-muted); font-size: 0.9rem; margin-left: 10px;">(2024)</span>
        </div>
        <table class="ratio-category-table">
            <thead>
                <tr>
                    <th>Ratio</th>
                    <th>${companyNames.alphabet}</th>
                    <th>${companyNames.meta}</th>
                    <th>${companyNames.apple}</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    ratios.forEach(ratioKey => {
        const values = companies.map(company => RATIO_MAP[ratioKey](company, year));
        
        // Find best value index
        const numericValues = values.map(v => {
            const numStr = String(v).replace(/[^0-9.-]/g, '');
            return parseFloat(numStr);
        });
        
        let bestIndex = -1;
        if (numericValues.every(v => !isNaN(v))) {
            const maxValue = Math.max(...numericValues);
            bestIndex = numericValues.indexOf(maxValue);
        }
        
        // Format all values
        const formattedValues = values.map(v => formatRatioValue(v));
        
        html += `
            <tr>
                <td><strong>${RATIO_NAMES[ratioKey]}</strong></td>
                ${formattedValues.map((v, i) => `<td class="${i === bestIndex ? 'best-value' : ''}">${v}</td>`).join('')}
            </tr>
        `;
    });
    
    html += `
            </tbody>
        </table>
    `;
    
    display.innerHTML = html;
}


        document.addEventListener('DOMContentLoaded', function() {
            // Initialize game panel
            loadGameState();
            
            // Analysis Mode event listeners
            document.getElementById('companySelect').addEventListener('change', function(e) {
                currentCompany = e.target.value;
                const comparisonGroup = document.getElementById('comparisonGroup');
                
                if (currentCompany === 'compare') {
                    comparisonGroup.style.display = 'block';
                    currentComparison = ''; // Reset comparison
                } else {
                    comparisonGroup.style.display = 'none';
                    currentComparison = '';
                    render();
                }
            });

            document.getElementById('comparisonSelect').addEventListener('change', function(e) {
                currentComparison = e.target.value;
                if (currentComparison) {
                    render();
                }
            });

            document.getElementById('analysisSelect').addEventListener('change', function(e) {
                currentAnalysis = e.target.value;
                updateControlVisibility();
                render();
            });

            document.getElementById('yearSelect').addEventListener('change', function(e) {
                currentPeriod = e.target.value;
                render();
            });

            document.getElementById('ratioYearSelect').addEventListener('change', function(e) {
                currentRatioYear = e.target.value;
                render();
            });

            // Ratio Guide Modal
            document.getElementById('ratioGuideBtn').addEventListener('click', function() {
                openRatioGuide();
            });

            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('ratioGuideModal').style.display = 'none';
            });

            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                const modal = document.getElementById('ratioGuideModal');
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Quick Ratio Lookup event listeners
            document.getElementById('quickRatioSelect').addEventListener('change', function(e) {
                const ratioKey = e.target.value;
                if (ratioKey) {
                    // Clear category selection
                    document.getElementById('quickCategorySelect').value = '';
                    renderQuickRatioComparison(ratioKey);
                } else {
                    document.getElementById('quickRatioDisplay').innerHTML = `
                        <div style="color: var(--text-muted); text-align: center; padding: 20px;">
                            Select a ratio or category above to compare all three companies
                        </div>
                    `;
                }
            });

            document.getElementById('quickCategorySelect').addEventListener('change', function(e) {
                const category = e.target.value;
                if (category) {
                    // Clear individual ratio selection
                    document.getElementById('quickRatioSelect').value = '';
                    renderQuickCategoryComparison(category);
                } else {
                    document.getElementById('quickRatioDisplay').innerHTML = `
                        <div style="color: var(--text-muted); text-align: center; padding: 20px;">
                            Select a ratio or category above to compare all three companies
                        </div>
                    `;
                }
            });

            updateControlVisibility();
            render();
        });

        function updateControlVisibility() {
            const yearGroup = document.getElementById('yearGroup');
            const ratioYearGroup = document.getElementById('ratioYearGroup');
            
            if (currentAnalysis === 'ratios') {
                yearGroup.style.display = 'none';
                ratioYearGroup.style.display = 'block';
            } else if (currentAnalysis === 'trend') {
                yearGroup.style.display = 'none';
                ratioYearGroup.style.display = 'none';
            } else {
                yearGroup.style.display = 'block';
                ratioYearGroup.style.display = 'none';
            }
        }

        function formatNumber(num, decimals = 0) {
            if (num === null || num === undefined) return 'N/A';
            return num.toLocaleString('en-US', { 
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals 
            });
        }

        function formatPercent(num, decimals = 1) {
            if (num === null || num === undefined) return 'N/A';
            return num.toFixed(decimals) + '%';
        }

        function calculateTrendIndex(value, baseValue) {
            return ((value / baseValue) * 100).toFixed(1);
        }

        function renderHorizontalAnalysis(company) {
            const data = DATA[company].horizontal[currentPeriod];
            const years = currentPeriod.split('-');
            const companyName = company === 'alphabet' ? 'Alphabet Inc.' : company === 'meta' ? 'Meta Platforms Inc.' : 'Apple Inc.';

            return `
                <div class="card">
                    <h2 class="card-title">Horizontal Analysis - ${companyName}</h2>
                    <p class="card-subtitle">Income Statement | ${years[0]} vs ${years[1]}</p>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Line Item</th>
                                    <th class="number">${years[1]} ($M)</th>
                                    <th class="number">${years[0]} ($M)</th>
                                    <th class="number">Difference ($M)</th>
                                    <th class="number">Change %</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(row => {
                                    const colorClass = row.pct > 0 ? 'positive' : (row.pct < 0 ? 'negative' : '');
                                    const year1Key = currentPeriod === '2022-2023' ? 'y2023' : 'y2024';
                                    const year2Key = currentPeriod === '2022-2023' ? 'y2022' : 'y2023';
                                    const isBold = row.item.includes('Total') || row.item.includes('Income') || row.item.includes('Revenues');
                                    
                                    return `
                                        <tr>
                                            <td${isBold ? ' style="font-weight: bold;"' : ''}>${row.item}</td>
                                            <td class="number${isBold ? ' ' : ''}"${isBold ? ' style="font-weight: bold;"' : ''}>${formatNumber(row[year1Key])}</td>
                                            <td class="number${isBold ? ' ' : ''}"${isBold ? ' style="font-weight: bold;"' : ''}>${formatNumber(row[year2Key])}</td>
                                            <td class="number ${colorClass}">${formatNumber(row.diff)}</td>
                                            <td class="number ${colorClass}">${formatPercent(row.pct)}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderVerticalAnalysis(company) {
            const data = DATA[company].vertical[currentPeriod];
            const years = currentPeriod.split('-');
            const companyName = company === 'alphabet' ? 'Alphabet Inc.' : company === 'meta' ? 'Meta Platforms Inc.' : 'Apple Inc.';

            return `
                <div class="card">
                    <h2 class="card-title">Vertical Analysis - ${companyName}</h2>
                    <p class="card-subtitle">Income Statement | Common-Size Analysis</p>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Line Item</th>
                                    <th class="number">${years[1]} ($M)</th>
                                    <th class="number">% of Revenue</th>
                                    <th class="number">${years[0]} ($M)</th>
                                    <th class="number">% of Revenue</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(row => {
                                    const year1Key = currentPeriod === '2022-2023' ? 'y2023' : 'y2024';
                                    const pct1Key = currentPeriod === '2022-2023' ? 'pct2023' : 'pct2024';
                                    const year2Key = currentPeriod === '2022-2023' ? 'y2022' : 'y2023';
                                    const pct2Key = currentPeriod === '2022-2023' ? 'pct2022' : 'pct2023';
                                    const isBold = row.item.includes('Total') || row.item.includes('Income') || row.item.includes('Revenues');
                                    
                                    return `
                                        <tr>
                                            <td${isBold ? ' style="font-weight: bold;"' : ''}>${row.item}</td>
                                            <td class="number"${isBold ? ' style="font-weight: bold;"' : ''}>${formatNumber(row[year1Key])}</td>
                                            <td class="number"${isBold ? ' style="font-weight: bold;"' : ''}>${formatPercent(row[pct1Key])}</td>
                                            <td class="number"${isBold ? ' style="font-weight: bold;"' : ''}>${formatNumber(row[year2Key])}</td>
                                            <td class="number"${isBold ? ' style="font-weight: bold;"' : ''}>${formatPercent(row[pct2Key])}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderTrendAnalysis(company) {
            const trend = DATA[company].trend;
            const companyName = company === 'alphabet' ? 'Alphabet Inc.' : company === 'meta' ? 'Meta Platforms Inc.' : 'Apple Inc.';

            return `
                <div class="card">
                    <h2 class="card-title">Trend Analysis - ${companyName}</h2>
                    <p class="card-subtitle">Three-Year Trend | 2022 Base Year (Index = 100)</p>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th class="number">2022 ($M)</th>
                                    <th class="number">Index</th>
                                    <th class="number">2023 ($M)</th>
                                    <th class="number">Index</th>
                                    <th class="number">2024 ($M)</th>
                                    <th class="number">Index</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="font-weight: bold;">Revenue</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.revenue[2022])}</td>
                                    <td class="number">100.0</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.revenue[2023])}</td>
                                    <td class="number positive">${calculateTrendIndex(trend.revenue[2023], trend.revenue[2022])}</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.revenue[2024])}</td>
                                    <td class="number positive">${calculateTrendIndex(trend.revenue[2024], trend.revenue[2022])}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Net Income</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.netIncome[2022])}</td>
                                    <td class="number">100.0</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.netIncome[2023])}</td>
                                    <td class="number positive">${calculateTrendIndex(trend.netIncome[2023], trend.netIncome[2022])}</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.netIncome[2024])}</td>
                                    <td class="number positive">${calculateTrendIndex(trend.netIncome[2024], trend.netIncome[2022])}</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;">Operating Cash Flow</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.operatingCashFlow[2022])}</td>
                                    <td class="number">100.0</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.operatingCashFlow[2023])}</td>
                                    <td class="number positive">${calculateTrendIndex(trend.operatingCashFlow[2023], trend.operatingCashFlow[2022])}</td>
                                    <td class="number" style="font-weight: bold;">${formatNumber(trend.operatingCashFlow[2024])}</td>
                                    <td class="number positive">${calculateTrendIndex(trend.operatingCashFlow[2024], trend.operatingCashFlow[2022])}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderRatios(company, year) {
            const companyName = company === 'alphabet' ? 'Alphabet Inc.' : company === 'meta' ? 'Meta Platforms Inc.' : 'Apple Inc.';
            const ratioData = DATA.ratios[year];
            
            return `
                <div class="card">
                    <h2 class="card-title">Financial Ratios - ${companyName} (${year})</h2>
                    <p class="card-subtitle">Complete ratio analysis across 5 categories</p>

                    <div class="category-header">üí∞ Ability to Pay Current Liabilities</div>
                    <div class="ratio-grid">
                        ${ratioData.liquidity.map(ratio => `
                            <div class="ratio-card">
                                <div class="ratio-name" data-tooltip="${ratio.description}">${ratio.name}</div>
                                <div class="ratio-value" data-calc="${ratio.description}\n\n${ratio[company].calculation}">${
                                    ratio[company].value >= 1000 ? 
                                    '$' + formatNumber(ratio[company].value) :
                                    formatNumber(ratio[company].value, 2)
                                }</div>
                                <div class="ratio-label">${ratio.formula}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="category-header">üìä Ability to Sell Inventory and Collect Receivables</div>
                    <div class="ratio-grid">
                        ${ratioData.activity.map(ratio => `
                            <div class="ratio-card">
                                <div class="ratio-name" data-tooltip="${ratio.description}">${ratio.name}</div>
                                <div class="ratio-value ${ratio[company].value === null ? 'na-badge' : ''}" data-calc="${ratio.description}\n\n${ratio[company].calculation}">${ratio[company].display || formatNumber(ratio[company].value, 2)}</div>
                                <div class="ratio-label">${ratio.formula}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="category-header">‚öñÔ∏è Ability to Pay Long-Term Debt</div>
                    <div class="ratio-grid">
                        ${ratioData.solvency.map(ratio => `
                            <div class="ratio-card">
                                <div class="ratio-name" data-tooltip="${ratio.description}">${ratio.name}</div>
                                <div class="ratio-value" data-calc="${ratio.description}\n\n${ratio[company].calculation}">${ratio[company].display || formatNumber(ratio[company].value, 2)}</div>
                                <div class="ratio-label">${ratio.formula}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="category-header">üìà Profitability</div>
                    <div class="ratio-grid">
                        ${ratioData.profitability.map(ratio => `
                            <div class="ratio-card">
                                <div class="ratio-name" data-tooltip="${ratio.description}">${ratio.name}</div>
                                <div class="ratio-value" data-calc="${ratio.description}\n\n${ratio[company].calculation}">${ratio[company].display || formatNumber(ratio[company].value, 2)}</div>
                                <div class="ratio-label">${ratio.formula}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="category-header">üíµ Stock as Investment</div>
                    <div class="ratio-grid">
                        ${ratioData.investment.map(ratio => `
                            <div class="ratio-card">
                                <div class="ratio-name" data-tooltip="${ratio.description}">${ratio.name}</div>
                                <div class="ratio-value" data-calc="${ratio.description}\n\n${ratio[company].calculation}">${ratio[company].display || formatNumber(ratio[company].value, 2)}</div>
                                <div class="ratio-label">${ratio.formula}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderComparison() {
            if (currentAnalysis === 'horizontal') {
                return renderHorizontalComparison();
            } else if (currentAnalysis === 'vertical') {
                return renderVerticalComparison();
            } else if (currentAnalysis === 'trend') {
                return renderTrendComparison();
            } else {
                return renderRatioComparison();
            }
        }

        function renderHorizontalComparison() {
            const years = currentPeriod.split('-');
            
            return `
                <div class="card">
                    <h2 class="card-title">Horizontal Analysis Comparison</h2>
                    <p class="card-subtitle">Income Statement | ${years[0]} vs ${years[1]}</p>
                    <div class="side-by-side">
                        ${renderHorizontalAnalysis('alphabet')}
                        ${renderHorizontalAnalysis('meta')}
                    </div>
                </div>
            `;
        }

        function renderVerticalComparison() {
            const years = currentPeriod.split('-');
            
            return `
                <div class="card">
                    <h2 class="card-title">Vertical Analysis Comparison</h2>
                    <p class="card-subtitle">Common-Size Income Statement | ${years[0]} vs ${years[1]}</p>
                    <div class="side-by-side">
                        ${renderVerticalAnalysis('alphabet')}
                        ${renderVerticalAnalysis('meta')}
                    </div>
                </div>
            `;
        }

        function renderTrendComparison() {
            return `
                <div class="card">
                    <h2 class="card-title">Trend Analysis Comparison</h2>
                    <p class="card-subtitle">Three-Year Trend | 2022 Base Year (Index = 100)</p>
                    <div class="side-by-side">
                        ${renderTrendAnalysis('alphabet')}
                        ${renderTrendAnalysis('meta')}
                    </div>
                </div>
            `;
        }

        function renderRatioComparison() {
            const ratioData = DATA.ratios[currentRatioYear];
            
            return `
                <div class="card">
                    <h2 class="card-title">Financial Ratios Comparison (${currentRatioYear})</h2>
                    <p class="card-subtitle">Side-by-side comparison of key performance indicators</p>

                    <div class="category-header">üí∞ Ability to Pay Current Liabilities</div>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="company-name">Alphabet</div>
                            ${ratioData.liquidity.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value">${
                                        ratio.alphabet.value >= 1000 ? 
                                        '$' + formatNumber(ratio.alphabet.value) :
                                        formatNumber(ratio.alphabet.value, 2)
                                    }</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="comparison-card">
                            <div class="company-name">Meta</div>
                            ${ratioData.liquidity.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value">${
                                        ratio.meta.value >= 1000 ? 
                                        '$' + formatNumber(ratio.meta.value) :
                                        formatNumber(ratio.meta.value, 2)
                                    }</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="category-header">üìä Ability to Sell Inventory and Collect Receivables</div>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="company-name">Alphabet</div>
                            ${ratioData.activity.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value ${ratio.alphabet.value === null ? 'na-badge' : ''}">${ratio.alphabet.display || formatNumber(ratio.alphabet.value, 2)}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="comparison-card">
                            <div class="company-name">Meta</div>
                            ${ratioData.activity.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value ${ratio.meta.value === null ? 'na-badge' : ''}">${ratio.meta.display || formatNumber(ratio.meta.value, 2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="category-header">‚öñÔ∏è Ability to Pay Long-Term Debt</div>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="company-name">Alphabet</div>
                            ${ratioData.solvency.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value">${ratio.alphabet.display || formatNumber(ratio.alphabet.value, 2)}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="comparison-card">
                            <div class="company-name">Meta</div>
                            ${ratioData.solvency.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value">${ratio.meta.display || formatNumber(ratio.meta.value, 2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="category-header">üìà Profitability</div>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="company-name">Alphabet</div>
                            ${ratioData.profitability.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value">${ratio.alphabet.display || formatNumber(ratio.alphabet.value, 2)}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="comparison-card">
                            <div class="company-name">Meta</div>
                            ${ratioData.profitability.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value">${ratio.meta.display || formatNumber(ratio.meta.value, 2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="category-header">üíµ Stock as Investment</div>
                    <div class="comparison-grid">
                        <div class="comparison-card">
                            <div class="company-name">Alphabet</div>
                            ${ratioData.investment.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value">${ratio.alphabet.display || formatNumber(ratio.alphabet.value, 2)}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="comparison-card">
                            <div class="company-name">Meta</div>
                            ${ratioData.investment.map(ratio => `
                                <div class="metric">
                                    <span class="metric-label">${ratio.name}</span>
                                    <span class="metric-value">${ratio.meta.display || formatNumber(ratio.meta.value, 2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }


        function openRatioGuide() {
    const modal = document.getElementById('ratioGuideModal');
    const content = document.getElementById('ratioGuideContent');
    
    content.innerHTML = `
        <div class="ratio-section">
            <div class="ratio-section-title">üí∞ ABILITY TO PAY CURRENT LIABILITIES</div>
            
            <div class="ratio-item">
                <div class="ratio-item-name">Working Capital</div>
                <div class="ratio-item-definition">How many dollars of current assets is available for every dollar of current liabilities</div>
                <div class="ratio-item-formula">Formula: Current Assets - Current Liabilities</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Current Assets: $150,000<br>
                    ‚Ä¢ Current Liabilities: $100,000<br>
                    ‚Ä¢ <strong>Working Capital = $150,000 - $100,000 = $50,000</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì Positive working capital means the company has enough short-term assets to cover short-term debts<br>
                    ‚úì $50,000 working capital means $50,000 cushion after paying all current liabilities
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Cash Ratio</div>
                <div class="ratio-item-definition">How many dollars of cash is available for every dollar of current liabilities</div>
                <div class="ratio-item-formula">Formula: Cash and Cash Equivalents √∑ Current Liabilities</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Cash: $40,000<br>
                    ‚Ä¢ Current Liabilities: $100,000<br>
                    ‚Ä¢ <strong>Cash Ratio = $40,000 √∑ $100,000 = 0.40 or 40%</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì A ratio of 0.40 means for every $1.00 owed, the company has $0.40 in cash<br>
                    ‚úì Higher is better for immediate liquidity<br>
                    ‚úì Typical range: 0.20 - 0.70 for most companies
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Acid-Test Ratio (Quick Ratio)</div>
                <div class="ratio-item-definition">How many dollars of liquid assets is available for every dollar of current liabilities</div>
                <div class="ratio-item-formula">Formula: (Cash + Marketable Securities + Accounts Receivable) √∑ Current Liabilities</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Cash: $40,000<br>
                    ‚Ä¢ Marketable Securities: $30,000<br>
                    ‚Ä¢ Accounts Receivable: $50,000<br>
                    ‚Ä¢ Current Liabilities: $100,000<br>
                    ‚Ä¢ <strong>Acid-Test Ratio = ($40,000 + $30,000 + $50,000) √∑ $100,000 = 1.20</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì A ratio of 1.20 means $1.20 in quick assets for every $1.00 of debt<br>
                    ‚úì Excludes inventory (may not convert to cash quickly)<br>
                    ‚úì Ratio above 1.0 is generally considered good
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Current Ratio</div>
                <div class="ratio-item-definition">How many dollars of current assets is available for every dollar of current liabilities</div>
                <div class="ratio-item-formula">Formula: Current Assets √∑ Current Liabilities</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Current Assets: $200,000<br>
                    ‚Ä¢ Current Liabilities: $100,000<br>
                    ‚Ä¢ <strong>Current Ratio = $200,000 √∑ $100,000 = 2.0</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì A ratio of 2.0 means $2.00 in current assets for every $1.00 owed<br>
                    ‚úì Typical healthy range: 1.5 - 3.0<br>
                    ‚úì Below 1.0 may indicate liquidity problems (unless company has efficient cash management like Apple)
                </div>
            </div>
        </div>

        <div class="ratio-section">
            <div class="ratio-section-title">üìä ABILITY TO SELL INVENTORY AND COLLECT RECEIVABLES</div>
            
            <div class="ratio-item">
                <div class="ratio-item-name">Inventory Turnover</div>
                <div class="ratio-item-definition">How many times inventory is sold and replaced during the period</div>
                <div class="ratio-item-formula">Formula: Cost of Goods Sold √∑ Average Inventory</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Cost of Goods Sold: $500,000<br>
                    ‚Ä¢ Average Inventory: $50,000<br>
                    ‚Ä¢ <strong>Inventory Turnover = $500,000 √∑ $50,000 = 10.0x</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì A turnover of 10x means inventory was sold and replaced 10 times during the year<br>
                    ‚úì Higher turnover generally indicates efficient inventory management<br>
                    ‚úì Varies greatly by industry (grocery stores: 15-20x, jewelry stores: 1-2x)
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Days' Sales in Inventory</div>
                <div class="ratio-item-definition">The average number of days inventory is held by a company</div>
                <div class="ratio-item-formula">Formula: 365 days √∑ Inventory Turnover</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Inventory Turnover: 10.0x<br>
                    ‚Ä¢ <strong>Days' Sales in Inventory = 365 √∑ 10.0 = 36.5 days</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 36.5 days means it takes about 37 days on average to sell inventory<br>
                    ‚úì Lower is generally better (faster sales)<br>
                    ‚úì Depends on industry and business model
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Gross Profit Percentage</div>
                <div class="ratio-item-definition">Gross profit generated for every $1 of Revenue</div>
                <div class="ratio-item-formula">Formula: Gross Profit √∑ Net Sales Revenue</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Gross Profit: $400,000<br>
                    ‚Ä¢ Net Sales Revenue: $1,000,000<br>
                    ‚Ä¢ <strong>Gross Profit % = $400,000 √∑ $1,000,000 = 0.40 or 40%</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 40% means for every $1.00 in sales, the company keeps $0.40 after cost of goods<br>
                    ‚úì Higher is better - indicates pricing power or efficient operations<br>
                    ‚úì Varies by industry (software: 70-90%, retail: 20-40%)
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Accounts Receivable Turnover</div>
                <div class="ratio-item-definition">How many times receivables are collected and converted into cash</div>
                <div class="ratio-item-formula">Formula: Net Credit Sales √∑ Average Accounts Receivable</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Net Credit Sales: $800,000<br>
                    ‚Ä¢ Average Accounts Receivable: $100,000<br>
                    ‚Ä¢ <strong>A/R Turnover = $800,000 √∑ $100,000 = 8.0x</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì A turnover of 8x means receivables were collected 8 times during the year<br>
                    ‚úì Higher is generally better (faster collection)<br>
                    ‚úì Shows effectiveness of credit and collection policies
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Days' Sales in Receivables</div>
                <div class="ratio-item-definition">The average number of days it takes to collect receivables</div>
                <div class="ratio-item-formula">Formula: 365 days √∑ Accounts Receivable Turnover</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Accounts Receivable Turnover: 8.0x<br>
                    ‚Ä¢ <strong>Days' Sales in Receivables = 365 √∑ 8.0 = 45.6 days</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 45.6 days means it takes about 46 days on average to collect payment<br>
                    ‚úì Lower is better (faster collection)<br>
                    ‚úì Compare to company's credit terms (e.g., Net 30, Net 60)
                </div>
            </div>
        </div>

        <div class="ratio-section">
            <div class="ratio-section-title">‚öñÔ∏è ABILITY TO PAY LONG-TERM DEBT</div>
            
            <div class="ratio-item">
                <div class="ratio-item-name">Debt to Asset Ratio</div>
                <div class="ratio-item-definition">The percentage of total assets provided by creditors</div>
                <div class="ratio-item-formula">Formula: Total Liabilities √∑ Total Assets</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Total Liabilities: $300,000<br>
                    ‚Ä¢ Total Assets: $1,000,000<br>
                    ‚Ä¢ <strong>Debt to Asset Ratio = $300,000 √∑ $1,000,000 = 0.30 or 30%</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 30% means creditors have financed 30% of the company's assets<br>
                    ‚úì Lower is generally better (less financial risk)<br>
                    ‚úì Typical range: 30-60% depending on industry
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Debt to Equity Ratio</div>
                <div class="ratio-item-definition">How many dollars of debt for every dollar of equity</div>
                <div class="ratio-item-formula">Formula: Total Liabilities √∑ Total Stockholders' Equity</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Total Liabilities: $300,000<br>
                    ‚Ä¢ Total Equity: $700,000<br>
                    ‚Ä¢ <strong>Debt to Equity Ratio = $300,000 √∑ $700,000 = 0.43x</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 0.43x means $0.43 in debt for every $1.00 of equity<br>
                    ‚úì Lower is generally better (less financial leverage)<br>
                    ‚úì Typical range: 0.3 - 1.5 depending on industry
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Times Interest Earned</div>
                <div class="ratio-item-definition">Measures a company's ability to make its interest payments</div>
                <div class="ratio-item-formula">Formula: Operating Income √∑ Interest Expense</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Operating Income: $200,000<br>
                    ‚Ä¢ Interest Expense: $20,000<br>
                    ‚Ä¢ <strong>Times Interest Earned = $200,000 √∑ $20,000 = 10.0x</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 10x means operating income is 10 times the interest expense<br>
                    ‚úì Higher is better (greater safety margin)<br>
                    ‚úì Below 2.5x may indicate difficulty meeting interest obligations
                </div>
            </div>
        </div>

        <div class="ratio-section">
            <div class="ratio-section-title">üìà PROFITABILITY</div>
            
            <div class="ratio-item">
                <div class="ratio-item-name">Profit Margin on Sales</div>
                <div class="ratio-item-definition">Net income generated for every dollar of sales</div>
                <div class="ratio-item-formula">Formula: Net Income √∑ Net Sales</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Net Income: $150,000<br>
                    ‚Ä¢ Net Sales: $1,000,000<br>
                    ‚Ä¢ <strong>Profit Margin = $150,000 √∑ $1,000,000 = 0.15 or 15%</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 15% means for every $1.00 in sales, the company earns $0.15 profit<br>
                    ‚úì Higher is better<br>
                    ‚úì Varies by industry (tech: 15-30%, retail: 2-10%)
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Return on Assets (ROA)</div>
                <div class="ratio-item-definition">Net income generated for every dollar of assets</div>
                <div class="ratio-item-formula">Formula: (Net Income + Interest Expense) √∑ Average Total Assets</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Net Income: $150,000<br>
                    ‚Ä¢ Interest Expense: $10,000<br>
                    ‚Ä¢ Average Total Assets: $1,000,000<br>
                    ‚Ä¢ <strong>ROA = ($150,000 + $10,000) √∑ $1,000,000 = 0.16 or 16%</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 16% means the company generates $0.16 profit for every $1.00 of assets<br>
                    ‚úì Higher is better - indicates efficient use of assets<br>
                    ‚úì Good ROA: 5%+ (varies by industry)
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Asset Turnover</div>
                <div class="ratio-item-definition">How efficiently assets are being used to generate sales</div>
                <div class="ratio-item-formula">Formula: Net Sales √∑ Average Total Assets</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Net Sales: $1,200,000<br>
                    ‚Ä¢ Average Total Assets: $1,000,000<br>
                    ‚Ä¢ <strong>Asset Turnover = $1,200,000 √∑ $1,000,000 = 1.2x</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 1.2x means the company generates $1.20 in sales for every $1.00 of assets<br>
                    ‚úì Higher is better - more sales from same assets<br>
                    ‚úì Capital-intensive businesses (utilities) have lower ratios than service businesses
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Return on Equity (ROE)</div>
                <div class="ratio-item-definition">Net income generated for every dollar of equity</div>
                <div class="ratio-item-formula">Formula: Net Income √∑ Average Total Equity</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Net Income: $150,000<br>
                    ‚Ä¢ Average Total Equity: $600,000<br>
                    ‚Ä¢ <strong>ROE = $150,000 √∑ $600,000 = 0.25 or 25%</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 25% means the company generates $0.25 profit for every $1.00 of shareholder equity<br>
                    ‚úì Higher is better - shows effective use of shareholder investment<br>
                    ‚úì Good ROE: 15%+ (varies by industry)
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Earnings Per Share (EPS)</div>
                <div class="ratio-item-definition">Profit earned for each share of outstanding shares</div>
                <div class="ratio-item-formula">Formula: (Net Income - Preferred Dividends) √∑ Weighted Average Common Shares Outstanding</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Net Income: $150,000<br>
                    ‚Ä¢ Preferred Dividends: $0<br>
                    ‚Ä¢ Weighted Average Shares: 50,000<br>
                    ‚Ä¢ <strong>EPS = $150,000 √∑ 50,000 = $3.00</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì $3.00 EPS means each share earned $3.00 of profit<br>
                    ‚úì Used to compare profitability across different-sized companies<br>
                    ‚úì Growth in EPS is positive signal for investors
                </div>
            </div>
        </div>

        <div class="ratio-section">
            <div class="ratio-section-title">üíµ STOCK AS INVESTMENT</div>
            
            <div class="ratio-item">
                <div class="ratio-item-name">Price-Earnings (P/E) Ratio</div>
                <div class="ratio-item-definition">How much an investor must pay for a share of current and future earnings</div>
                <div class="ratio-item-formula">Formula: Market Price Per Share √∑ Earnings Per Share</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Market Price Per Share: $45.00<br>
                    ‚Ä¢ Earnings Per Share: $3.00<br>
                    ‚Ä¢ <strong>P/E Ratio = $45.00 √∑ $3.00 = 15.0x</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 15x means investors pay $15.00 for every $1.00 of earnings<br>
                    ‚úì Lower P/E may indicate undervalued stock (or lower growth expectations)<br>
                    ‚úì Higher P/E may indicate overvalued stock (or high growth expectations)<br>
                    ‚úì Compare to industry average and company's historical P/E
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Dividend Yield</div>
                <div class="ratio-item-definition">How much an investor receives in dividends for every $1 paid for stock</div>
                <div class="ratio-item-formula">Formula: Annual Dividend Per Share √∑ Market Price Per Share</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Annual Dividend Per Share: $2.00<br>
                    ‚Ä¢ Market Price Per Share: $50.00<br>
                    ‚Ä¢ <strong>Dividend Yield = $2.00 √∑ $50.00 = 0.04 or 4%</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 4% means investor receives $0.04 in dividends for every $1.00 invested<br>
                    ‚úì Higher yield attracts income-seeking investors<br>
                    ‚úì Growth companies often have lower yields (reinvest profits)<br>
                    ‚úì Mature companies often have higher yields
                </div>
            </div>

            <div class="ratio-item">
                <div class="ratio-item-name">Dividend Payout</div>
                <div class="ratio-item-definition">How much of the EPS is paid out in dividends</div>
                <div class="ratio-item-formula">Formula: Annual Dividend Per Share √∑ Earnings Per Share</div>
                <div class="ratio-item-example">
                    <h4>Simple Example:</h4>
                    ‚Ä¢ Annual Dividend Per Share: $2.00<br>
                    ‚Ä¢ Earnings Per Share: $4.00<br>
                    ‚Ä¢ <strong>Dividend Payout = $2.00 √∑ $4.00 = 0.50 or 50%</strong>
                </div>
                <div class="ratio-item-interpretation">
                    ‚úì 50% means the company pays out half its earnings as dividends<br>
                    ‚úì Remaining 50% is retained for growth/reinvestment<br>
                    ‚úì High payout (>70%) may limit growth but provides income<br>
                    ‚úì Low payout (<30%) suggests focus on growth over current income
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px; padding: 20px; background: var(--primary); border-radius: 10px;">
            <p style="margin: 0; font-size: 0.9rem; color: var(--text-muted);">
                üí° Remember: Always compare ratios to industry averages, competitors, and the company's historical trends for meaningful analysis!
            </p>
        </div>
    `;
    
    modal.style.display = 'block';
}



        function renderFlexibleComparison(comparisonType) {
    // Parse which companies to compare
    let companies = [];
    let comparisonTitle = '';
    
    if (comparisonType === 'alphabet-meta') {
        companies = ['alphabet', 'meta'];
        comparisonTitle = 'Alphabet vs Meta';
    } else if (comparisonType === 'alphabet-apple') {
        companies = ['alphabet', 'apple'];
        comparisonTitle = 'Alphabet vs Apple';
    } else if (comparisonType === 'meta-apple') {
        companies = ['meta', 'apple'];
        comparisonTitle = 'Meta vs Apple';
    } else if (comparisonType === 'all-three') {
        companies = ['alphabet', 'meta', 'apple'];
        comparisonTitle = 'All Three Companies';
    }
    
    if (companies.length === 0) {
        return '<div class="card"><h2 class="card-title">Please select a comparison from the dropdown</h2></div>';
    }
    
    // Render based on analysis type
    if (currentAnalysis === 'horizontal') {
        return renderHorizontalComparison(companies, comparisonTitle);
    } else if (currentAnalysis === 'vertical') {
        return renderVerticalComparison(companies, comparisonTitle);
    } else if (currentAnalysis === 'trend') {
        return renderTrendComparison(companies, comparisonTitle);
    } else if (currentAnalysis === 'ratios') {
        return renderRatioComparisonFlex(companies, comparisonTitle);
    }
}

function renderHorizontalComparison(companies, title) {
    const years = currentPeriod.split('-');
    let html = `
        <div class="card">
            <h2 class="card-title">Horizontal Analysis Comparison - ${title}</h2>
            <p class="card-subtitle">Income Statement | ${years[0]} vs ${years[1]}</p>
            <div class="${companies.length === 3 ? 'comparison-grid' : 'side-by-side'}">
    `;
    
    companies.forEach(company => {
        html += renderHorizontalAnalysis(company);
    });
    
    html += `
            </div>
        </div>
    `;
    return html;
}

function renderVerticalComparison(companies, title) {
    const years = currentPeriod.split('-');
    let html = `
        <div class="card">
            <h2 class="card-title">Vertical Analysis Comparison - ${title}</h2>
            <p class="card-subtitle">Common-Size Income Statement | ${years[0]} vs ${years[1]}</p>
            <div class="${companies.length === 3 ? 'comparison-grid' : 'side-by-side'}">
    `;
    
    companies.forEach(company => {
        html += renderVerticalAnalysis(company);
    });
    
    html += `
            </div>
        </div>
    `;
    return html;
}

function renderTrendComparison(companies, title) {
    let html = `
        <div class="card">
            <h2 class="card-title">Trend Analysis Comparison - ${title}</h2>
            <p class="card-subtitle">Three-Year Trend | 2022 Base Year (Index = 100)</p>
            <div class="${companies.length === 3 ? 'comparison-grid' : 'side-by-side'}">
    `;
    
    companies.forEach(company => {
        html += renderTrendAnalysis(company);
    });
    
    html += `
            </div>
        </div>
    `;
    return html;
}

function renderRatioComparisonFlex(companies, title) {
    const ratioData = DATA.ratios[currentRatioYear];
    const companyNames = {
        'alphabet': 'Alphabet',
        'meta': 'Meta',
        'apple': 'Apple'
    };
    
    let html = `
        <div class="card">
            <h2 class="card-title">Financial Ratios Comparison - ${title} (${currentRatioYear})</h2>
            <p class="card-subtitle">Side-by-side comparison of key performance indicators</p>

            <div class="category-header">üí∞ Ability to Pay Current Liabilities</div>
            <div class="comparison-grid">
    `;
    
    companies.forEach(company => {
        html += `
                <div class="comparison-card">
                    <div class="company-name">${companyNames[company]}</div>
                    ${ratioData.liquidity.map(ratio => `
                        <div class="metric">
                            <span class="metric-label">${ratio.name}</span>
                            <span class="metric-value">${
                                ratio[company].value >= 1000 ? 
                                '$' + formatNumber(ratio[company].value) :
                                formatNumber(ratio[company].value, 2)
                            }</span>
                        </div>
                    `).join('')}
                </div>
        `;
    });
    
    html += `
            </div>

            <div class="category-header">üìä Ability to Sell Inventory and Collect Receivables</div>
            <div class="comparison-grid">
    `;
    
    companies.forEach(company => {
        html += `
                <div class="comparison-card">
                    <div class="company-name">${companyNames[company]}</div>
                    ${ratioData.activity.map(ratio => `
                        <div class="metric">
                            <span class="metric-label">${ratio.name}</span>
                            <span class="metric-value ${ratio[company].value === null ? 'na-badge' : ''}">${ratio[company].display || formatNumber(ratio[company].value, 2)}</span>
                        </div>
                    `).join('')}
                </div>
        `;
    });
    
    html += `
            </div>

            <div class="category-header">‚öñÔ∏è Ability to Pay Long-Term Debt</div>
            <div class="comparison-grid">
    `;
    
    companies.forEach(company => {
        html += `
                <div class="comparison-card">
                    <div class="company-name">${companyNames[company]}</div>
                    ${ratioData.solvency.map(ratio => `
                        <div class="metric">
                            <span class="metric-label">${ratio.name}</span>
                            <span class="metric-value">${ratio[company].display || formatNumber(ratio[company].value, 2)}</span>
                        </div>
                    `).join('')}
                </div>
        `;
    });
    
    html += `
            </div>

            <div class="category-header">üìà Profitability</div>
            <div class="comparison-grid">
    `;
    
    companies.forEach(company => {
        html += `
                <div class="comparison-card">
                    <div class="company-name">${companyNames[company]}</div>
                    ${ratioData.profitability.map(ratio => `
                        <div class="metric">
                            <span class="metric-label">${ratio.name}</span>
                            <span class="metric-value">${ratio[company].display || formatNumber(ratio[company].value, 2)}</span>
                        </div>
                    `).join('')}
                </div>
        `;
    });
    
    html += `
            </div>

            <div class="category-header">üíµ Stock as Investment</div>
            <div class="comparison-grid">
    `;
    
    companies.forEach(company => {
        html += `
                <div class="comparison-card">
                    <div class="company-name">${companyNames[company]}</div>
                    ${ratioData.investment.map(ratio => `
                        <div class="metric">
                            <span class="metric-label">${ratio.name}</span>
                            <span class="metric-value">${ratio[company].display || formatNumber(ratio[company].value, 2)}</span>
                        </div>
                    `).join('')}
                </div>
        `;
    });
    
    html += `
            </div>
        </div>
    `;
    
    return html;
}


        function render() {
            const content = document.getElementById('content');
            let html = '';

            if (currentCompany === 'compare' && currentComparison) {
                // Handle flexible comparison mode
                html = renderFlexibleComparison(currentComparison);
            } else if (currentCompany === 'both') {
                // Legacy support for 'both' (defaults to alphabet vs meta)
                html = renderComparison();
            } else if (currentCompany !== 'compare') {
                // Single company view
                if (currentAnalysis === 'horizontal') {
                    html = renderHorizontalAnalysis(currentCompany);
                } else if (currentAnalysis === 'vertical') {
                    html = renderVerticalAnalysis(currentCompany);
                } else if (currentAnalysis === 'trend') {
                    html = renderTrendAnalysis(currentCompany);
                } else if (currentAnalysis === 'ratios') {
                    html = renderRatios(currentCompany, currentRatioYear);
                }
            }

            content.innerHTML = html;
        }
    </script>
</body>
</html>
